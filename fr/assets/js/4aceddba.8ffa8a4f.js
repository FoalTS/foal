"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7251],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>d});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var i=n.createContext({}),p=function(e){var t=n.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,s=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(r),d=a,h=m["".concat(i,".").concat(d)]||m[d]||u[d]||s;return r?n.createElement(h,o(o({ref:t},c),{},{components:r})):n.createElement(h,o({ref:t},c))}));function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=r.length,o=new Array(s);o[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var p=2;p<s;p++)o[p]=r[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},88549:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>p});var n=r(87462),a=(r(67294),r(3905));const s={title:"Les Scripts Shell",id:"tuto-4-the-shell-scripts",slug:"4-the-shell-scripts"},o=void 0,l={unversionedId:"tutorials/real-world-example-with-react/tuto-4-the-shell-scripts",id:"version-2.x/tutorials/real-world-example-with-react/tuto-4-the-shell-scripts",title:"Les Scripts Shell",description:"Vos mod\xe8les sont pr\xeats \xe0 \xeatre utilis\xe9s. Comme dans le tutoriel pr\xe9c\xe9dent, vous allez utiliser des scripts shell pour alimenter la base de donn\xe9es.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-2.x/tutorials/real-world-example-with-react/4-the-shell-scripts.md",sourceDirName:"tutorials/real-world-example-with-react",slug:"/tutorials/real-world-example-with-react/4-the-shell-scripts",permalink:"/fr/docs/2.x/tutorials/real-world-example-with-react/4-the-shell-scripts",draft:!1,editUrl:"https://github.com/FoalTS/foal/edit/master/docs/versioned_docs/version-2.x/tutorials/real-world-example-with-react/4-the-shell-scripts.md",tags:[],version:"2.x",sidebarPosition:4,frontMatter:{title:"Les Scripts Shell",id:"tuto-4-the-shell-scripts",slug:"4-the-shell-scripts"},sidebar:"someSidebar",previous:{title:"Les Mod\xe8les User et Story",permalink:"/fr/docs/2.x/tutorials/real-world-example-with-react/3-the-models"},next:{title:"Votre Premi\xe8re Route",permalink:"/fr/docs/2.x/tutorials/real-world-example-with-react/5-our-first-route"}},i={},p=[{value:"Le script <code>cr\xe9er-utilisateur</code>",id:"le-script-cr\xe9er-utilisateur",level:2},{value:"Le sc\xe9nario <code>create-story</code>.",id:"le-sc\xe9nario-create-story",level:2}],c={toc:p};function u(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Vos mod\xe8les sont pr\xeats \xe0 \xeatre utilis\xe9s. Comme dans le tutoriel pr\xe9c\xe9dent, vous allez utiliser des scripts shell pour alimenter la base de donn\xe9es."),(0,a.kt)("h2",{id:"le-script-cr\xe9er-utilisateur"},"Le script ",(0,a.kt)("inlineCode",{parentName:"h2"},"cr\xe9er-utilisateur")),(0,a.kt)("p",null,"Un script appel\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},"create-user")," existe d\xe9j\xe0 dans le r\xe9pertoire ",(0,a.kt)("inlineCode",{parentName:"p"},"scripts"),"."),(0,a.kt)("p",null,"Ouvrez le fichier et remplacez son contenu par ce qui suit :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// 3p\nimport { hashPassword } from '@foal/core';\nimport { createConnection, getConnection } from 'typeorm';\n\n// App\nimport { User } from '../app/entities';\n\nexport const schema = {\n  additionalProperties: false,\n  properties: {\n    email: { type: 'string', format: 'email', maxLength: 255 },\n    password: { type: 'string' },\n    name: { type: 'string', maxLength: 255 },\n  },\n  required: [ 'email', 'password' ],\n  type: 'object',\n};\n\nexport async function main(args: { email: string, password: string, name?: string }) {\n  const user = new User();\n  user.email = args.email;\n  user.password = await hashPassword(args.password);\n  user.name = args.name ?? 'Unknown';\n  user.avatar = '';\n\n  await createConnection();\n\n  try {\n    console.log(await user.save());\n  } catch (error) {\n    console.log(error.message);\n  } finally {\n    await getConnection().close();\n  }\n}\n\n")),(0,a.kt)("p",null,"Certaines parties de ce code devraient vous sembler famili\xe8res."),(0,a.kt)("p",null,"L'objet ",(0,a.kt)("inlineCode",{parentName:"p"},"schema")," est utilis\xe9 pour valider les arguments tap\xe9s sur la ligne de commande. Dans notre cas, le script attend deux param\xe8tres obligatoires ",(0,a.kt)("inlineCode",{parentName:"p"},"email")," et ",(0,a.kt)("inlineCode",{parentName:"p"},"password")," et un optionnel ",(0,a.kt)("inlineCode",{parentName:"p"},"name"),". La propri\xe9t\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},"format")," v\xe9rifie que la cha\xeene ",(0,a.kt)("inlineCode",{parentName:"p"},"email")," est un email (pr\xe9sence du caract\xe8re ",(0,a.kt)("inlineCode",{parentName:"p"},"@"),", etc). "),(0,a.kt)("p",null,"La fonction ",(0,a.kt)("inlineCode",{parentName:"p"},"main")," est appel\xe9e apr\xe8s que la validation ait r\xe9ussi. Elle est divis\xe9e en plusieurs parties. D'abord, elle cr\xe9e un nouvel utilisateur avec les arguments sp\xe9cifi\xe9s dans la ligne de commande. Ensuite, elle \xe9tablit une connexion avec la base de donn\xe9es et enregistre l'utilisateur."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"La fonction ",(0,a.kt)("inlineCode",{parentName:"p"},"hashPassword")," est utilis\xe9e pour hacher et saler les mots de passe avant de les stocker dans la base de donn\xe9es. Pour des raisons de s\xe9curit\xe9, vous devez utiliser cette fonction avant de sauvegarder les mots de passe.")),(0,a.kt)("p",null,"Construisez le script."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm run build\n")),(0,a.kt)("p",null,"Cr\xe9ez ensuite deux nouveaux utilisateurs."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'foal run create-user email="john@foalts.org" password="john_password" name="John"\nfoal run create-user email="mary@foalts.org" password="mary_password" name="Mary"\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Si vous essayez de r\xe9ex\xe9cuter l'une de ces commandes, vous obtiendrez l'erreur MySQL ci-dessous car la cl\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},"email")," est unique."),(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"ER_DUP_ENTRY: Duplicate entry 'john@foalts.org' for key 'IDX_xxx'"))),(0,a.kt)("h2",{id:"le-sc\xe9nario-create-story"},"Le sc\xe9nario ",(0,a.kt)("inlineCode",{parentName:"h2"},"create-story"),"."),(0,a.kt)("p",null,"Le script ",(0,a.kt)("inlineCode",{parentName:"p"},"create-story")," est un peu plus complexe car ",(0,a.kt)("inlineCode",{parentName:"p"},"Story")," a une relation many-to-one avec ",(0,a.kt)("inlineCode",{parentName:"p"},"User"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"foal generate script create-story\n")),(0,a.kt)("p",null,"Ouvrez le fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"create-story.ts")," et remplacez son contenu."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createConnection } from 'typeorm';\nimport { Story, User } from '../app/entities';\n\nexport const schema = {\n  additionalProperties: false,\n  properties: {\n    author: { type: 'string', format: 'email', maxLength: 255 },\n    title: { type: 'string', maxLength: 255 },\n    link: { type: 'string', maxLength: 255 },\n  },\n  required: [ 'author', 'title', 'link' ],\n  type: 'object',\n};\n\nexport async function main(args: { author: string, title: string, link: string }) {\n  const connection = await createConnection();\n\n  const user = await User.findOneOrFail({ email: args.author });\n\n  const story = new Story();\n  story.author = user;\n  story.title = args.title;\n  story.link = args.link;\n\n  try {\n    console.log(await story.save());\n  } catch (error) {\n    console.error(error);\n  } finally {\n    await connection.close();\n  }\n}\n\n")),(0,a.kt)("p",null,"Nous avons ajout\xe9 un param\xe8tre ",(0,a.kt)("inlineCode",{parentName:"p"},"author")," pour savoir quel utilisateur a post\xe9 l'article. Il attend l'email de l'utilisateur."),(0,a.kt)("p",null,"La fonction ",(0,a.kt)("inlineCode",{parentName:"p"},"main")," essaie alors de trouver l'utilisateur qui poss\xe8de cet email. S'il existe, l'utilisateur est ajout\xe9 \xe0 la ",(0,a.kt)("em",{parentName:"p"},"story")," en tant qu'auteur. Si ce n'est pas le cas, le script se termine par un message affich\xe9 dans la console."),(0,a.kt)("p",null,"Construisez le script."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm run build\n")),(0,a.kt)("p",null,"Et cr\xe9ez de nouveaux posts pour chaque utilisateur."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'foal run create-story author="john@foalts.org" title="How to build a simple to-do list" link="https://foalts.org/docs/tutorials/simple-todo-list/1-installation"\nfoal run create-story author="mary@foalts.org" title="FoalTS architecture overview" link="https://foalts.org/docs/architecture/architecture-overview"\nfoal run create-story author="mary@foalts.org" title="Authentication with Foal" link="https://foalts.org/docs/authentication-and-access-control/quick-start"\n')))}u.isMDXComponent=!0}}]);