"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[34278],{27060:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var o=r(45519),s=r(74848),t=r(28453);const i={title:"Version 5.0 release notes",authors:"LoicPoullain",image:"blog/twitter-banners/version-5.0-release-notes.png",tags:["release"]},l=void 0,a={authorsImageUrls:[void 0]},c=[{value:"Supported versions of Node and TypeScript",id:"supported-versions-of-node-and-typescript",level:2},{value:"TypeORM upgrade",id:"typeorm-upgrade",level:2},{value:"Better typing",id:"better-typing",level:2},{value:"Controller parameters",id:"controller-parameters",level:2},{value:"Logging",id:"logging",level:2},{value:"Shell scripts",id:"shell-scripts",level:2},{value:"Removal of deprecated components",id:"removal-of-deprecated-components",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Banner",src:r(39716).A+"",width:"914",height:"315"})}),"\n",(0,s.jsxs)(n.p,{children:["Version 5.0 of ",(0,s.jsx)(n.a,{href:"https://foalts.org/",children:"Foal"})," is out!"]}),"\n",(0,s.jsx)(n.h2,{id:"supported-versions-of-node-and-typescript",children:"Supported versions of Node and TypeScript"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Support for Node 18 and Node 20 has been dropped and support for Node 22 has been added. Foal code is now compiled to ES2023."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The minimum supported version of TypeScript is version 5.5. Update your ",(0,s.jsx)(n.code,{children:"package.json"})," file accordingly."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install typescript@5.5\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["If you're using the ",(0,s.jsx)(n.code,{children:"GraphQLController"})," with the ",(0,s.jsx)(n.code,{children:"resolvers"})," property, you need to add the ",(0,s.jsx)(n.code,{children:"declare"})," keyword before the property name:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"\nexport class ApiController extends GraphQLController {\n  schema = // ...\n\n  @dependency\n  declare resolvers: RootResolverService;\n}\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"typeorm-upgrade",children:"TypeORM upgrade"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The minimum required version of TypeORM is v0.3.24."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install typeorm@0.3.24\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"better-typing",children:"Better typing"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The default type of ",(0,s.jsx)(n.code,{children:"Context.state"})," is now ",(0,s.jsx)(n.code,{children:"{}"}),". This way, you'll get a compilation error if you forget to specify a type for the state."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Version 4\nclass MyController {\n  @Get('/foobar')\n  foobar(ctx: Context) {\n    // Does not throw.\n    console.log(ctx.state.shoppingCart);\n  }\n}\n\n// Version 5\nclass MyController {\n  @Get('/foobar')\n  foobar(ctx: Context) {\n    // Throws a compilation error: Property 'shoppingCart' does not exist on type '{}'.ts(2339)\n    console.log(ctx.state.shoppingCart);\n  }\n}\n\n// Version 5 (without error)\nclass MyController {\n  @Get('/foobar')\n  foobar(ctx: Context<any, { shoppingCart: object }>) {\n    console.log(ctx.state.shoppingCart);\n  }\n}\n\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The return value of the social services ",(0,s.jsx)(n.code,{children:"getUserInfoFromTokens"})," method is now typed."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"controller-parameters",children:"Controller parameters"}),"\n",(0,s.jsx)(n.p,{children:"To facilitate the typing of the request body, path parameters and request parameters in controllers, the request object is now passed as a second argument to controller methods."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"    interface MyQuery {\n      // ...\n    }\n\n    interface MyBody {\n      // ...\n    }\n\n    interface MyParams {\n      // ...\n    }\n\n    // Version 4\n    class MyController {\n      @Get('/foobar')\n      foobar(ctx: Context) {\n        const query = ctx.request.query as MyQuery;\n        const body = ctx.request.body as MyQuery;\n        const params = ctx.request.params as MyParams;\n\n        // Do something\n      }\n      // OR\n      @Get('/foobar')\n      foobar(ctx: Context, params: MyParams, body: MyBody) {\n        const query = ctx.request.query as MyQuery;\n\n        // Do something\n      }\n    }\n\n    // Version 5\n    class MyController {\n      @Get('/foobar')\n      foobar(ctx: Context, { query, body, params }: { query: MyQuery, body: MyBody, params: MyParams }) {\n        // Do something\n      }\n    }\n"})}),"\n",(0,s.jsx)(n.h2,{id:"logging",children:"Logging"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"Logger.addLogContext(key, value)"})," method now accepts a record as parameter: ",(0,s.jsx)(n.code,{children:"Logger.addLogContext(context)"}),". This makes the function's signature more consistent with other logging methods (",(0,s.jsx)(n.code,{children:"info"}),", ",(0,s.jsx)(n.code,{children:"warn"}),", etc.) and allows multiple keys/values to be passed at once."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Version 4\nthis.logger.addLogContext('foo', 'bar');\nthis.logger.addLogContext('barfoo', 'foobar');\n\n// Version 5\nthis.logger.addLogContext({\n  foo: 'bar',\n  barfoo: 'foobar',\n});\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The deprecated ",(0,s.jsx)(n.code,{children:"settings.loggerFormat"})," configuration has been removed. If you want to disable HTTP logging, replace configuration ",(0,s.jsx)(n.code,{children:"settings.loggerFormat: 'none'"})," with ",(0,s.jsx)(n.code,{children:"settings.logger.logHttpRequests: false"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'// Version 4\n{\n  "settings": {\n    "loggerFormat": "none"\n  }\n}\n\n// Version 5\n{\n  "settings": {\n    "logger": {\n      "logHttpRequests": false\n    }\n  }\n}\n\n// Version 4\n{\n  "settings": {\n    "loggerFormat": "any other value than \'none\'"\n  }\n}\n\n// Version 5\n{\n  "settings": {}\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"shell-scripts",children:"Shell scripts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"main"})," function of shell scripts now receives an instance of ",(0,s.jsx)(n.code,{children:"ServiceManager"})," as second argument and the logger as third argument:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Version 4\nexport async function main(args: any) {\n  // ...\n}\n\n// Version 5\nexport async function main(args: any, services: ServiceManager, logger: Logger) {\n  // ...\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Log context are supported."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"When running a script, the script name as well as a script ID are added to the log context."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"At the end of script execution, as with an HTTP request, a log is printed to indicate whether the execution was successful or unsuccessful."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Any error thrown in the ",(0,s.jsx)(n.code,{children:"main"})," function is now logged with the framework logger."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Version 4\nexport async function main() {\n  const services = new ServiceManager();\n  const logger = services.get(Logger);\n\n  try {\n    // ...\n    throw new Error('Hello world');\n  } catch(error) {\n    logger.error(error.message { error });\n  }\n}\n\n// Version 5\nexport async function main() {\n  // ...\n  throw new Error('Hello world');\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"removal-of-deprecated-components",children:"Removal of deprecated components"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The deprecated hook ",(0,s.jsx)(n.code,{children:"@Log"})," has been removed. Use the ",(0,s.jsx)(n.code,{children:"Logger"})," service in a custom ",(0,s.jsx)(n.code,{children:"@Hook"})," instead."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The command alias ",(0,s.jsx)(n.code,{children:"npx foal run-script"})," has been removed. Use ",(0,s.jsx)(n.code,{children:"npx foal run"})," instead."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The deprecated method ",(0,s.jsx)(n.code,{children:"AbstractProvider.redirect"})," has been removed. Use ",(0,s.jsx)(n.code,{children:"AbstractProvider.createHttpResponseWithConsentPageUrl({ isRedirection: true })"})," instead."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Version 4\nreturn this.googleProvider.redirect();\n\n// Version 5\nreturn this.googleProvider.createHttpResponseWithConsentPageUrl({ isRedirection: true });\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var o=r(96540);const s={},t=o.createContext(s);function i(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(t.Provider,{value:n},e.children)}},39716:(e,n,r)=>{r.d(n,{A:()=>o});const o=r.p+"assets/images/banner-75d4fdd342b6996291a16c3021f7a72a.png"},45519:e=>{e.exports=JSON.parse('{"permalink":"/fr/blog/2025/05/27/version-5.0-release-notes","editUrl":"https://github.com/FoalTS/foal/edit/master/docs/blog/2025-05-27-version-5.0-release-notes.md","source":"@site/blog/2025-05-27-version-5.0-release-notes.md","title":"Version 5.0 release notes","description":"Banner","date":"2025-05-27T00:00:00.000Z","tags":[{"inline":true,"label":"release","permalink":"/fr/blog/tags/release"}],"readingTime":3.62,"hasTruncateMarker":true,"authors":[{"name":"Lo\xefc Poullain","title":"Creator of FoalTS. Software engineer.","url":"https://loicpoullain.com","socials":{"x":"https://x.com/Loic_Poullain","linkedin":"https://www.linkedin.com/in/loicpoullain/","github":"https://github.com/LoicPoullain","bluesky":"https://bsky.app/profile/loicpoullain.com"},"imageURL":"https://avatars1.githubusercontent.com/u/13604533?v=4","key":"LoicPoullain","page":null}],"frontMatter":{"title":"Version 5.0 release notes","authors":"LoicPoullain","image":"blog/twitter-banners/version-5.0-release-notes.png","tags":["release"]},"unlisted":false,"nextItem":{"title":"Version 4.6 release notes","permalink":"/fr/blog/2025/05/26/version-4.6-release-notes"}}')}}]);