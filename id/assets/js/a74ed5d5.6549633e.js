"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9162],{18207:e=>{e.exports=JSON.parse('{"permalink":"/id/blog/2024/08/22/version-4.5-release-notes","editUrl":"https://github.com/FoalTS/foal/edit/master/docs/blog/2024-08-22-version-4.5-release-notes.md","source":"@site/blog/2024-08-22-version-4.5-release-notes.md","title":"Version 4.5 release notes","description":"Banner","date":"2024-08-22T00:00:00.000Z","tags":[{"inline":true,"label":"release","permalink":"/id/blog/tags/release"}],"readingTime":2.425,"hasTruncateMarker":true,"authors":[{"name":"Lo\xefc Poullain","title":"Creator of FoalTS. Software engineer.","url":"https://loicpoullain.com","socials":{"x":"https://x.com/Loic_Poullain","linkedin":"https://www.linkedin.com/in/loicpoullain/","github":"https://github.com/LoicPoullain","bluesky":"https://bsky.app/profile/loicpoullain.com","mastodon":"https://mastodon.social/@LoicPoullain"},"imageURL":"https://avatars1.githubusercontent.com/u/13604533?v=4","key":"LoicPoullain","page":null}],"frontMatter":{"title":"Version 4.5 release notes","authors":"LoicPoullain","image":"blog/twitter-banners/version-4.5-release-notes.png","tags":["release"]},"unlisted":false,"prevItem":{"title":"Version 4.6 release notes","permalink":"/id/blog/2025/05/26/version-4.6-release-notes"},"nextItem":{"title":"Version 4.4 release notes","permalink":"/id/blog/2024/04/25/version-4.4-release-notes"}}')},28453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>a});var t=o(96540);const s={},i=t.createContext(s);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(i.Provider,{value:n},e.children)}},60572:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/banner-3f2086c61f3c010fc38db9701cd3d398.png"},69721:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});var t=o(18207),s=o(74848),i=o(28453);const r={title:"Version 4.5 release notes",authors:"LoicPoullain",image:"blog/twitter-banners/version-4.5-release-notes.png",tags:["release"]},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"Asynchronous tasks",id:"asynchronous-tasks",level:2},{value:"Social authentication for SPAs",id:"social-authentication-for-spas",level:2},{value:"Google social authentification",id:"google-social-authentification",level:2},{value:"Logging improvements",id:"logging-improvements",level:2},{value:"CLI fixes",id:"cli-fixes",level:2},{value:"Global use of CLI deprecated",id:"global-use-of-cli-deprecated",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Banner",src:o(60572).A+"",width:"914",height:"315"})}),"\n",(0,s.jsxs)(n.p,{children:["Version 4.5 of ",(0,s.jsx)(n.a,{href:"https://foalts.org/",children:"Foal"})," is out!"]}),"\n",(0,s.jsx)(n.h2,{id:"asynchronous-tasks",children:"Asynchronous tasks"}),"\n",(0,s.jsx)(n.p,{children:"In some situations, we need to execute a specific task without waiting for it and without blocking the request."}),"\n",(0,s.jsx)(n.p,{children:"This could be, for example, sending a specific message to the CRM or company chat. In this case, the user needs to be able to see his or her request completed as quickly as possible, even if the request to the CRM takes some time or fails."}),"\n",(0,s.jsxs)(n.p,{children:["To this end, Foal version 4.5 provides an ",(0,s.jsx)(n.code,{children:"AsyncService"})," to execute these tasks asynchronously, and correctly catch and log their errors where appropriate."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { AsyncService, dependency } from '@foal/core';\n\nimport { CRMService } from './somewhere';\n\nexport class SubscriptionService {\n  @dependency\n  asyncService: AsyncService;\n\n  @dependency\n  crmService: CRMService;\n\n  async subscribe(userId: number): Promise<void> {\n    // Do something\n\n    this.asyncService.run(() => this.crmService.updateUser(userId));\n  }\n}\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"social-authentication-for-spas",children:"Social authentication for SPAs"}),"\n",(0,s.jsxs)(n.p,{children:["If you wish to manually manage the redirection to the consent page on the client side (which is often necessary when developing an SPA), you can now do so with the ",(0,s.jsx)(n.code,{children:"createHttpResponseWithConsentPageUrl"})," method. It returns an ",(0,s.jsx)(n.code,{children:"HttpResponseOK"})," whose body contains the URL of the consent page."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export class AuthController {\n  @dependency\n  google: GoogleProvider;\n\n  @Get('/signin/google')\n  getConsentPageURL() {\n    return this.google.createHttpResponseWithConsentPageUrl();\n  }\n  \n  // ...\n\n}\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"google-social-authentification",children:"Google social authentification"}),"\n",(0,s.jsxs)(n.p,{children:["The typing of the ",(0,s.jsx)(n.code,{children:"GoogleProvider"})," service has been improved. The ",(0,s.jsx)(n.code,{children:"userInfo"})," property returned by ",(0,s.jsx)(n.code,{children:"getUserInfo"})," is now typed with the values returned by the Google server."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const { userInfo } = await this.googleProvider.getUserInfo(...);\n\n// userInfo.email, userInfo.family_name, etc\n"})}),"\n",(0,s.jsx)(n.h2,{id:"logging-improvements",children:"Logging improvements"}),"\n",(0,s.jsxs)(n.p,{children:["In previous versions, the util function ",(0,s.jsx)(n.code,{children:"displayServerURL"})," and configuration errors printed logs on several lines, which was not appropriate for logging software."]}),"\n",(0,s.jsxs)(n.p,{children:["From version 4.5 onwards, configuration errors are displayed on a single line and the ",(0,s.jsx)(n.code,{children:"displayServerURL"})," function is marked as deprecated."]}),"\n",(0,s.jsx)(n.h2,{id:"cli-fixes",children:"CLI fixes"}),"\n",(0,s.jsxs)(n.p,{children:["When running ",(0,s.jsx)(n.code,{children:"npx foal connect react"})," to connect the React application to the Foal application in development, the following features did not work:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Proxify requests from the client to the server without needing to enable CORS or specify a different port in development."}),"\n",(0,s.jsx)(n.li,{children:"Build the client application in the server application's public directory."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This is fixed in v4.5."}),"\n",(0,s.jsx)(n.h2,{id:"global-use-of-cli-deprecated",children:"Global use of CLI deprecated"}),"\n",(0,s.jsx)(n.p,{children:"In previous versions, the tutorial suggested installing the CLI globally to create a new application or generate files. However, it is considered bad practice to install a dependency globally for local use."}),"\n",(0,s.jsx)(n.p,{children:"In addition, the CLI was also installed locally so that the build command would work when deploying the application to a CI or to production. This was maintaining two versions of the CLI."}),"\n",(0,s.jsxs)(n.p,{children:["To correct this, in the documentation and examples, the CLI is now always installed and used locally. To use it, simply add ",(0,s.jsx)(n.code,{children:"npx"})," before each command (except for ",(0,s.jsx)(n.code,{children:"createapp"}),")."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Before\nfoal createapp my-app\n\nfoal generate script foobar\nfoal createsecret\n\n# After\nnpx @foal/cli createapp my-app\n\nnpx foal generate script foobar\nnpx foal createsecret\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);