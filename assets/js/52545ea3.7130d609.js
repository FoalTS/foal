"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[30003],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(96540);const o={},i=t.createContext(o);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(i.Provider,{value:n},e.children)}},61299:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"authentication/session-tokens","title":"Session Tokens","description":"Introduction","source":"@site/versioned_docs/version-4.x/authentication/session-tokens.md","sourceDirName":"authentication","slug":"/authentication/session-tokens","permalink":"/docs/4.x/authentication/session-tokens","draft":false,"unlisted":false,"editUrl":"https://github.com/FoalTS/foal/edit/master/docs/versioned_docs/version-4.x/authentication/session-tokens.md","tags":[],"version":"4.x","frontMatter":{"title":"Session Tokens","sidebar_label":"Session Tokens"},"sidebar":"someSidebar","previous":{"title":"Passwords","permalink":"/docs/4.x/authentication/password-management"},"next":{"title":"JSON Web Tokens","permalink":"/docs/4.x/authentication/jwt"}}');var o=s(74848),i=s(28453),r=s(65537),a=s(79329);const c={title:"Session Tokens",sidebar_label:"Session Tokens"},l=void 0,d={},h=[{value:"Introduction",id:"introduction",level:2},{value:"The Basics",id:"the-basics",level:2},{value:"Choosing a session store",id:"choosing-a-session-store",level:3},{value:"TypeORMStore",id:"typeormstore",level:4},{value:"RedisStore",id:"redisstore",level:4},{value:"MongoDBStore",id:"mongodbstore",level:4},{value:"Usage with the <code>Authorization</code> header",id:"usage-with-the-authorization-header",level:3},{value:"Usage with cookies",id:"usage-with-cookies",level:3},{value:"Adding authentication and access control",id:"adding-authentication-and-access-control",level:3},{value:"Destroying the session",id:"destroying-the-session",level:3},{value:"Reading User Information on the Client (cookies)",id:"reading-user-information-on-the-client-cookies",level:2},{value:"Save and Read Content",id:"save-and-read-content",level:2},{value:"Flash Content",id:"flash-content",level:3},{value:"Security",id:"security",level:2},{value:"Session Expiration Timeouts",id:"session-expiration-timeouts",level:3},{value:"Revoking Sessions",id:"revoking-sessions",level:3},{value:"Revoking One Session",id:"revoking-one-session",level:4},{value:"Revoking All Sessions",id:"revoking-all-sessions",level:4},{value:"Query All Sessions of a User",id:"query-all-sessions-of-a-user",level:3},{value:"Query All Connected Users",id:"query-all-connected-users",level:3},{value:"Force the Disconnection of a User",id:"force-the-disconnection-of-a-user",level:3},{value:"Re-generate the Session ID",id:"re-generate-the-session-id",level:3},{value:"Advanced",id:"advanced",level:2},{value:"Specify the Store Locally",id:"specify-the-store-locally",level:3},{value:"Cleanup Expired Sessions",id:"cleanup-expired-sessions",level:3},{value:"Implement a Custom Store",id:"implement-a-custom-store",level:3},{value:"Usage with Cookies",id:"usage-with-cookies-1",level:3},{value:"Do not Auto-Create the Session",id:"do-not-auto-create-the-session",level:4},{value:"Override the Cookie Options",id:"override-the-cookie-options",level:4},{value:"Require the Cookie",id:"require-the-cookie",level:4},{value:"Read a Session From a Token",id:"read-a-session-from-a-token",level:3},{value:"Save Manually a Session",id:"save-manually-a-session",level:3},{value:"Provide A Custom Client to Use in the Stores",id:"provide-a-custom-client-to-use-in-the-stores",level:3},{value:"<code>RedisStore</code>",id:"redisstore-1",level:4},{value:"<code>MongoDBStore</code>",id:"mongodbstore-1",level:4}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["This document assumes that you have alread read the ",(0,o.jsx)(n.a,{href:"/docs/4.x/authentication/quick-start",children:"Quick Start"})," page."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"In FoalTS, web sessions are temporary states that can be associated with a specific user. They are identified by a token and are mainly used to keep users authenticated between several HTTP requests (the client sends the token on each request to authenticate the user)."}),"\n",(0,o.jsx)(n.p,{children:"A session usually begins when the user logs in (or starts visiting the website) and ends after a period of inactivity or when the user logs out. By inactivity, we mean that the server no longer receives requests from the authenticated user for a certain period of time."}),"\n",(0,o.jsx)(n.h2,{id:"the-basics",children:"The Basics"}),"\n",(0,o.jsx)(n.h3,{id:"choosing-a-session-store",children:"Choosing a session store"}),"\n",(0,o.jsxs)(n.p,{children:["To begin, you must first specify where the session states will be stored. FoalTS provides several ",(0,o.jsx)(n.em,{children:"session stores"})," for this. For example, you can use the ",(0,o.jsx)(n.code,{children:"TypeORMStore"})," to save the sessions in your SQL database or the ",(0,o.jsx)(n.code,{children:"RedisStore"})," to save them in a redis cache."]}),"\n",(0,o.jsxs)(n.p,{children:["To do so, the package name of the store must be provided with the configuration key ",(0,o.jsx)(n.code,{children:"settings.session.store"}),"."]}),"\n",(0,o.jsxs)(r.A,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],children:[(0,o.jsx)(a.A,{value:"yaml",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'settings:\n  session:\n    store: "@foal/typeorm"\n'})})}),(0,o.jsx)(a.A,{value:"json",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "settings": {\n    "session": {\n      "store": "@foal/typeorm",\n    }\n  }\n}\n'})})}),(0,o.jsx)(a.A,{value:"js",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'module.exports = {\n  settings: {\n    session: {\n      store: "@foal/typeorm",\n    }\n  }\n}\n'})})})]}),"\n",(0,o.jsx)(n.h4,{id:"typeormstore",children:"TypeORMStore"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm install typeorm@0.3.17 @foal/typeorm\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This store uses the default TypeORM connection whose configuration is usually specified in ",(0,o.jsx)(n.code,{children:"config/default.{json|yml|js}"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Session states are saved in the ",(0,o.jsx)(n.code,{children:"databasesession"})," table of your SQL database. In order to create it, you need to add and run migrations. For this purpose, you can export the ",(0,o.jsx)(n.code,{children:"DatabaseSession"})," entity in your user file and execute the following commands."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"entities/user.entity.ts"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { DatabaseSession } from '@foal/typeorm';\nimport { BaseEntity, Entity } from 'typeorm';\n\n@Entity()\nexport class User extends BaseEntity {\n  /* ... */\n}\n\nexport { DatabaseSession }\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm run makemigrations\nnpm run migrations\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Warning"}),": If you use TypeORM store, then your entity IDs must be numbers (not strings)."]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"redisstore",children:"RedisStore"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm install @foal/redis\n"})}),"\n",(0,o.jsx)(n.p,{children:"In order to use this store, you must provide the redis URI in the configuration."}),"\n",(0,o.jsxs)(r.A,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],children:[(0,o.jsx)(a.A,{value:"yaml",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"settings:\n  session:\n    store: \"@foal/redis\"\n  redis:\n    uri: 'redis://localhost:6379'\n"})})}),(0,o.jsx)(a.A,{value:"json",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "settings": {\n    "session": {\n      "store": "@foal/redis",\n    },\n    "redis": {\n      "uri": "redis://localhost:6379"\n    }\n  }\n}\n'})})}),(0,o.jsx)(a.A,{value:"js",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'module.exports = {\n  settings: {\n    session: {\n      store: "@foal/redis",\n    },\n    redis: {\n      uri: "redis://localhost:6379"\n    }\n  }\n}\n'})})})]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["If you are using the redis store, please ensure that you have a ",(0,o.jsx)(n.code,{children:"@dependency store: Store"})," property in at least one of your controllers or services. Otherwise, the connection to the redis database will not be established when the application starts."]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"mongodbstore",children:"MongoDBStore"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm install @foal/mongodb\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["This package uses the ",(0,o.jsx)(n.a,{href:"https://www.npmjs.com/package/mongodb",children:"mongodb Node.JS driver"})," which uses the ",(0,o.jsx)(n.a,{href:"https://www.npmjs.com/package/@types/node",children:"@types/node"})," package under the hood. If you get type compilation errors, try to upgrade this dependency."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["This store saves your session states in a MongoDB database (using the collection ",(0,o.jsx)(n.code,{children:"sessions"}),"). In order to use it, you must provide the MongoDB URI in the configuration."]}),"\n",(0,o.jsxs)(r.A,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],children:[(0,o.jsx)(a.A,{value:"yaml",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"settings:\n  session:\n    store: \"@foal/mongodb\"\n  mongodb:\n    uri: 'mongodb://localhost:27017'\n"})})}),(0,o.jsx)(a.A,{value:"json",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "settings": {\n    "session": {\n      "store": "@foal/mongodb",\n    },\n    "mongodb": {\n      "uri": "mongodb://localhost:27017"\n    }\n  }\n}\n'})})}),(0,o.jsx)(a.A,{value:"js",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'module.exports = {\n  settings: {\n    session: {\n      store: "@foal/mongodb",\n    },\n    mongodb: {\n      uri: "mongodb://localhost:27017"\n    }\n  }\n}\n'})})})]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["If you are using the MongoDB store, please ensure that you have a ",(0,o.jsx)(n.code,{children:"@dependency store: Store"})," property in at least one of your controllers or services. Otherwise, the connection to the MondoDB database will not be established when the application starts."]}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"usage-with-the-authorization-header",children:["Usage with the ",(0,o.jsx)(n.code,{children:"Authorization"})," header"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["This section explains how to use sessions with a ",(0,o.jsx)(n.code,{children:"bearer"})," token and the ",(0,o.jsx)(n.code,{children:"Authorization"})," header. See the section below to see how to use them with cookies."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The mechanism is as follows:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Upon login, create the session and assign it to ",(0,o.jsx)(n.code,{children:"ctx.session"}),". Then return the session token in the response."]}),"\n",(0,o.jsxs)(n.li,{children:["On subsequent requests, send the token in the ",(0,o.jsx)(n.code,{children:"Authorization"})," header with this scheme: ",(0,o.jsx)(n.code,{children:"Authorization: Bearer <token>"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, createSession, dependency, Get, HttpResponseOK, Post, Store, UseSessions } from '@foal/core';\n\n@UseSessions()\nexport class ApiController {\n\n  @dependency\n  store: Store;\n\n  @Post('/login')\n  async login(ctx: Context) {\n    // Check the user credentials...\n\n    ctx.session = await createSession(this.store);\n\n    // See the \"authentication\" section below\n    // to see how to associate a user to the session.\n\n    return new HttpResponseOK({\n      token: ctx.session.getToken()\n    });\n  }\n\n  @Get('/products')\n  readProducts(ctx: Context) {\n    // If the request has an Authorization header with a valid token\n    // then ctx.session is defined.\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["If the ",(0,o.jsx)(n.code,{children:"Authorization"})," header does not use the ",(0,o.jsx)(n.code,{children:"bearer"})," scheme or if the token is invalid or expired, then the hook returns a 400 or 401 error."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["If you want to make sure that ",(0,o.jsx)(n.code,{children:"ctx.session"})," is set and get a 400 error if no ",(0,o.jsx)(n.code,{children:"Authorization"})," header is provided, you can use the ",(0,o.jsx)(n.code,{children:"required"})," option for this."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, createSession, dependency, Get, HttpResponseOK, Post, Store, UseSessions } from '@foal/core';\n\nexport class ApiController {\n\n  @dependency\n  store: Store;\n\n  @Post('/login')\n  @UseSessions()\n  async login(ctx: Context) {\n    // Check the user credentials...\n\n    ctx.session = await createSession(this.store);\n\n    // See the \"authentication\" section below\n    // to see how to associate a user to the session.\n\n    return new HttpResponseOK({\n      token: ctx.session.getToken()\n    });\n  }\n\n  @Get('/products')\n  @UseSessions({ required: true })\n  readProducts(ctx: Context) {\n    // ctx.session is defined.\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"usage-with-cookies",children:"Usage with cookies"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["This section explains how to use sessions with cookies. See the section above to see how to use them with a ",(0,o.jsx)(n.code,{children:"bearer"})," token and the ",(0,o.jsx)(n.code,{children:"Authorization"})," header."]}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Be aware that if you use cookies, your application must provide a ",(0,o.jsx)(n.a,{href:"/docs/4.x/security/csrf-protection",children:"CSRF defense"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["When using the ",(0,o.jsx)(n.code,{children:"@UseSessions"})," hook with the ",(0,o.jsx)(n.code,{children:"cookie"})," option, FoalTS makes sure that ",(0,o.jsx)(n.code,{children:"ctx.session"})," is always set and takes care of managing the session token on the client (using a cookie)."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, dependency, Get, HttpResponseOK, Post, Store, UseSessions } from '@foal/core';\n\n@UseSessions({ cookie: true })\nexport class ApiController {\n\n  @dependency\n  store: Store;\n\n  @Post('/login')\n  login(ctx: Context) {\n    // Check the user credentials...\n\n    // See the \"authentication\" section below\n    // to see how to associate a user to the session.\n\n    return new HttpResponseOK();\n  }\n\n  @Get('/products')\n  readProducts(ctx: Context) {\n    // ctx.session is defined.\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["If the session has expired, the hook returns a 401 error. If you want to redirect the user to the login page, you can use the ",(0,o.jsx)(n.code,{children:"redirectTo"})," option to do so."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"@UseSessions({\n  cookie: true,\n  redirectTo: '/login'\n})\nexport class ApiController {\n\n  @Get('/products')\n  readProducts(ctx: Context) {\n    // ctx.session is defined.\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"adding-authentication-and-access-control",children:"Adding authentication and access control"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["This section explains how to associate a specific user to a session and how to use ",(0,o.jsx)(n.code,{children:"ctx.user"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Sessions can be used to authenticate users. To do this, you can use the ",(0,o.jsx)(n.code,{children:"Session.setUser"})," method and the ",(0,o.jsx)(n.code,{children:"user"})," option of ",(0,o.jsx)(n.code,{children:"@UseSessions"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, createSession, dependency, Get, HttpResponseOK, Post, Store, UseSessions } from '@foal/core';\n\nimport { User } from '../entities';\n\n@UseSessions({\n  // If the session is attached to a user,\n  // then retrieve the user from the database\n  // and assign it to ctx.user\n  user: (id: number) => User.findOneBy({ id }),\n})\nexport class ApiController {\n\n  @dependency\n  store: Store;\n\n  @Post('/login')\n  async login(ctx: Context) {\n    // Check the user credentials...\n    // const user = ...\n\n    ctx.session = await createSession(this.store);\n\n    // Attach the user to the session.\n    ctx.session.setUser(user);\n\n    return new HttpResponseOK({\n      token: ctx.session.getToken()\n    });\n  }\n\n  @Get('/products')\n  readProducts(ctx: Context<User>) {\n    // If the ctx.session is defined and the session is attached to a user\n    // then ctx.user is an instance of User. Otherwise it is null.\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["If you want to restrict certain routes to authenticated users, you can use the ",(0,o.jsx)(n.code,{children:"@UserRequired"})," hook for this."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, Get, HttpResponseOK, UserRequired, UseSessions } from '@foal/core';\n\nimport { User } from '../entities';\n\n@UseSessions({\n  user: (id: number) => User.findOneBy({ id }),\n})\nexport class ApiController {\n\n  @Get('/products')\n  @UserRequired()\n  readProducts(ctx: Context) {\n    // ctx.user is defined.\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["If the user is not authenticated, the hook returns a 401 error. If you want to redirect the user to the login page, you can use the ",(0,o.jsx)(n.code,{children:"redirectTo"})," option to do so."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, Get, HttpResponseOK, UserRequired, UseSessions } from '@foal/core';\n\nimport { User } from '../entities';\n\n@UseSessions({\n  redirectTo: '/login',\n  user: (id: number) => User.findOneBy({ id }),\n})\nexport class ApiController {\n\n  @Get('/products')\n  @UserRequired({\n    redirectTo: '/login'\n  })\n  readProducts(ctx: Context) {\n    // ctx.user is defined.\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"destroying-the-session",children:"Destroying the session"}),"\n",(0,o.jsxs)(n.p,{children:["Sessions can be destroyed (i.e users can be logged out) using their ",(0,o.jsx)(n.code,{children:"destroy"})," method."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, HttpResponseNoContent, Post, UseSessions } from '@foal/core';\n\nexport class AuthController {\n\n  @Post('/logout')\n  @UseSessions()\n  async logout(ctx: Context) {\n    if (ctx.session) {\n      await ctx.session.destroy();\n    }\n    return new HttpResponseNoContent();\n  }\n\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"reading-user-information-on-the-client-cookies",children:"Reading User Information on the Client (cookies)"}),"\n",(0,o.jsxs)(n.p,{children:["When building a SPA with cookie-based authentication, it can sometimes be difficult to know if the user is logged in or to obtain certain information about the user (",(0,o.jsx)(n.code,{children:"isAdmin"}),", etc)."]}),"\n",(0,o.jsxs)(n.p,{children:["Since the authentication token is stored in a cookie with the ",(0,o.jsx)(n.code,{children:"httpOnly"})," directive set to ",(0,o.jsx)(n.code,{children:"true"})," (to mitigate XSS attacks), the front-end application has no way of knowing if a user is logged in, except by making an additional request to the server."]}),"\n",(0,o.jsxs)(n.p,{children:["To solve this problem, Foal provides an option called ",(0,o.jsx)(n.code,{children:"userCookie"})," that allows you to set an additional cookie that the frontend can read with the content you choose. This cookie is synchronized with the session and is refreshed at each request and destroyed when the session expires or when the user logs out."]}),"\n",(0,o.jsxs)(n.p,{children:["In the following example, the ",(0,o.jsx)(n.code,{children:"user"})," cookie is empty if no user is logged in or contains certain information about him/her otherwise. This is particularly useful if you need to display UI elements based on user characteristics."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Server-side code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"function userToJSON(user: User|null) {\n  if (!user) {\n    return 'null';\n  }\n\n  return JSON.stringify({\n    email: user.email,\n    isAdmin: user.isAdmin\n  });\n}\n\n@UseSessions({\n  cookie: true,\n  user: (id: number) => User.findOneBy({ id }),\n  userCookie: (ctx, services) => userToJSON(ctx.user as User|null)\n})\nexport class ApiController {\n\n  @Get('/products')\n  @UserRequired()\n  async readProducts(ctx: Context<User>) {\n    const products = await Product.findBy({ owner: { id: ctx.user.id } });\n    return new HttpResponseOK(products);\n  }\n\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Cookies"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"User cookie",src:s(89932).A+"",width:"995",height:"41"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Client-side code"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const user = JSON.parse(decodeURIComponent(/* cookie value */));\n"})}),"\n",(0,o.jsx)(n.h2,{id:"save-and-read-content",children:"Save and Read Content"}),"\n",(0,o.jsxs)(n.p,{children:["You can access and modify the session content with the ",(0,o.jsx)(n.code,{children:"set"})," and ",(0,o.jsx)(n.code,{children:"get"})," methods."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, HttpResponseNoContent, Post, UseSessions } from '@foal/core';\n\n@UseSessions(/* ... */)\nexport class ApiController {\n\n  @Post('/subscribe')\n  subscribe(ctx: Context) {\n    const plan = ctx.session!.get<string>('plan', 'free');\n    // ...\n  }\n\n  @Post('/choose-premium-plan')\n  choosePremimumPlan(ctx: Context) {\n    ctx.session!.set('plan', 'premium');\n    return new HttpResponseNoContent();\n  }\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"flash-content",children:"Flash Content"}),"\n",(0,o.jsx)(n.p,{children:"Sometimes we may wish to store items in the session only for the next request."}),"\n",(0,o.jsx)(n.p,{children:'For example, when users enter incorrect credentials, they are redirected to the login page, and this time we may want to render the page with a specific message that says "Incorrect email or password". If the user refreshes the page, the message then disappears.'}),"\n",(0,o.jsx)(n.p,{children:"This can be done with flash content. The data will only be available on the next request."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"ctx.session.set('error', 'Incorrect email or password', { flash: true });\n"})}),"\n",(0,o.jsx)(n.h2,{id:"security",children:"Security"}),"\n",(0,o.jsx)(n.h3,{id:"session-expiration-timeouts",children:"Session Expiration Timeouts"}),"\n",(0,o.jsx)(n.p,{children:"Session states has two expiration timeouts."}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Timeout"}),(0,o.jsx)(n.th,{children:"Description"}),(0,o.jsx)(n.th,{children:"Default value"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Inactivity (or idle) timeout"}),(0,o.jsx)(n.td,{children:"Period of inactivity after which the session expires."}),(0,o.jsx)(n.td,{children:"15 minutes"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Absolute timeout"}),(0,o.jsx)(n.td,{children:"Period after which the session expires, regardless of its activity."}),(0,o.jsx)(n.td,{children:"1 week"})]})]})]}),"\n",(0,o.jsx)(n.p,{children:"If needed, the default values can be override in the configuration. The timeouts must be provided in seconds."}),"\n",(0,o.jsxs)(r.A,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],children:[(0,o.jsx)(a.A,{value:"yaml",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"settings:\n  session:\n    expirationTimeouts:\n      absolute: 2592000 # 30 days\n      inactivity: 1800 # 30 min\n"})})}),(0,o.jsx)(a.A,{value:"json",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "settings": {\n    "session": {\n      "expirationTimeouts": {\n        "absolute": 2592000,\n        "inactivity": 1800\n      }\n    }\n  }\n}\n'})})}),(0,o.jsx)(a.A,{value:"js",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"module.exports = {\n  settings: {\n    session: {\n      expirationTimeouts: {\n        absolute: 2592000, // 30 days\n        inactivity: 1800 // 30 min\n      }\n    }\n  }\n}\n"})})})]}),"\n",(0,o.jsx)(n.h3,{id:"revoking-sessions",children:"Revoking Sessions"}),"\n",(0,o.jsx)(n.h4,{id:"revoking-one-session",children:"Revoking One Session"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npx foal g script revoke-session\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Open ",(0,o.jsx)(n.code,{children:"scripts/revoke-session.ts"})," and update its content."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { createService, readSession, Store } from '@foal/core';\n\nimport { dataSource } from '../db';\n\nexport const schema = {\n  type: 'object',\n  properties: {\n    token: { type: 'string' },\n  },\n  required: [ 'token' ]\n}\n\nexport async function main({ token }: { token: string }) {\n  await dataSource.initialize();\n\n  const store = createService(Store);\n  await store.boot();\n\n  const session = await readSession(store, token);\n  if (session) {\n    await session.destroy();\n  }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Build the script."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm run build\n"})}),"\n",(0,o.jsx)(n.p,{children:"Run the script."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'npx foal run revoke-session token="lfdkszjanjiznr"\n'})}),"\n",(0,o.jsx)(n.h4,{id:"revoking-all-sessions",children:"Revoking All Sessions"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npx foal g script revoke-all-sessions\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Open ",(0,o.jsx)(n.code,{children:"scripts/revoke-all-sessions.ts"})," and update its content."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { createService, Store } from '@foal/core';\n\nimport { dataSource } from '../db';\n\nexport async function main() {\n  await dataSource.initialize();\n\n  const store = createService(Store);\n  await store.boot();\n  await store.clear();\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Build the script."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm run build\n"})}),"\n",(0,o.jsx)(n.p,{children:"Run the script."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npx foal run revoke-all-sessions\n"})}),"\n",(0,o.jsx)(n.h3,{id:"query-all-sessions-of-a-user",children:"Query All Sessions of a User"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"This feature is only available with the TypeORM store."})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const user = { id: 1 };\nconst ids = await store.getSessionIDsOf(user.id);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"query-all-connected-users",children:"Query All Connected Users"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"This feature is only available with the TypeORM store."})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const ids = await store.getAuthenticatedUserIds();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"force-the-disconnection-of-a-user",children:"Force the Disconnection of a User"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"This feature is only available with the TypeORM store."})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const user = { id: 1 };\nawait store.destroyAllSessionsOf(user.id);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"re-generate-the-session-id",children:"Re-generate the Session ID"}),"\n",(0,o.jsxs)(n.p,{children:["When a user logs in or change their password, it is a ",(0,o.jsx)(n.a,{href:"https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#renew-the-session-id-after-any-privilege-level-change",children:"good practice"})," to regenerate the session ID. This can be done with the ",(0,o.jsx)(n.code,{children:"regenerateID"})," method."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"await ctx.session.regenerateID();\n"})}),"\n",(0,o.jsx)(n.h2,{id:"advanced",children:"Advanced"}),"\n",(0,o.jsx)(n.h3,{id:"specify-the-store-locally",children:"Specify the Store Locally"}),"\n",(0,o.jsxs)(n.p,{children:["By default, the ",(0,o.jsx)(n.code,{children:"@UseSessions"})," hook and the ",(0,o.jsx)(n.code,{children:"Store"})," service retrieve the store to use from the configuration. This behavior can be override by importing the store directly into the code."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, createSession, dependency, Get, HttpResponseOK, Post, UseSessions } from '@foal/core';\nimport { RedisStore } from '@foal/redis';\n\n@UseSessions({ store: RedisStore })\nexport class ApiController {\n\n  @dependency\n  store: RedisStore;\n\n  @Post('/login')\n  async login(ctx: Context) {\n    // Check the user credentials...\n\n    ctx.session = await createSession(this.store);\n\n    return new HttpResponseOK({\n      token: ctx.session.getToken()\n    });\n  }\n\n  @Get('/products')\n  readProducts(ctx: Context) {\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"cleanup-expired-sessions",children:"Cleanup Expired Sessions"}),"\n",(0,o.jsxs)(n.p,{children:["By default, FoalTS removes expired sessions in ",(0,o.jsx)(n.code,{children:"TypeORMStore"})," and ",(0,o.jsx)(n.code,{children:"MongoDBStore"})," every 50 requests on average. This can be changed with this configuration key:"]}),"\n",(0,o.jsxs)(r.A,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],children:[(0,o.jsx)(a.A,{value:"yaml",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"settings:\n  session:\n    garbageCollector:\n      periodicity: 25\n"})})}),(0,o.jsx)(a.A,{value:"json",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "settings": {\n    "session": {\n      "garbageCollector": {\n        "periodicity": 25\n      }\n    }\n  }\n}\n'})})}),(0,o.jsx)(a.A,{value:"js",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"module.exports = {\n  settings: {\n    session: {\n      garbageCollector: {\n        periodicity: 25\n      }\n    }\n  }\n}\n"})})})]}),"\n",(0,o.jsx)(n.h3,{id:"implement-a-custom-store",children:"Implement a Custom Store"}),"\n",(0,o.jsxs)(n.p,{children:["If necessary, you can implement your own session store. This one must inherit the abstract class ",(0,o.jsx)(n.code,{children:"SessionStore"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["To use it, your can import it directly in your code (see the section ",(0,o.jsx)(n.em,{children:"Specify the Store Locally"}),") or use a ",(0,o.jsx)(n.a,{href:"/docs/4.x/architecture/services-and-dependency-injection#abstract-services",children:"relative path"})," in the configuration. In this case, the class must be exported with the name ",(0,o.jsx)(n.code,{children:"ConcreteSessionStore"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { SessionState, SessionStore } from '@foal/core';\n\nclass CustomSessionStore extends SessionStore {\n  save(state: SessionState, maxInactivity: number): Promise<void> {\n    // ...\n  }\n  read(id: string): Promise<SessionState | null> {\n    // ...\n  }\n  update(state: SessionState, maxInactivity: number): Promise<void> {\n    // ...\n  }\n  destroy(id: string): Promise<void> {\n    // ...\n  }\n  clear(): Promise<void> {\n    // ...\n  }\n  cleanUpExpiredSessions(maxInactivity: number, maxLifeTime: number): Promise<void> {\n    // ...\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Method"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"save"})}),(0,o.jsx)(n.td,{children:"Saves the session for the first time. If a session already exists with the given ID, a SessionAlreadyExists error MUST be thrown."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"read"})}),(0,o.jsxs)(n.td,{children:["Reads a session. If the session does not exist, the value ",(0,o.jsx)(n.code,{children:"null"})," MUST be returned."]})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"update"})}),(0,o.jsx)(n.td,{children:"Updates and extends the lifetime of a session. If the session no longer exists (i.e. has expired or been destroyed), the session MUST still be saved."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"destroy"})}),(0,o.jsx)(n.td,{children:"Deletes a session. If the session does not exist, NO error MUST be thrown."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"clear"})}),(0,o.jsx)(n.td,{children:"Clears all sessions."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"cleanUpExpiredSessions"})}),(0,o.jsx)(n.td,{children:"Some session stores may need to run periodically background jobs to cleanup expired sessions. This method deletes all expired sessions. If the store manages a cache database, then this method can remain empty but it must NOT throw an error."})]})]})]}),"\n",(0,o.jsxs)(n.p,{children:["Session stores do not manipulate ",(0,o.jsx)(n.code,{children:"Session"})," instances directly. Instead, they use ",(0,o.jsx)(n.code,{children:"SessionState"})," objects."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"interface SessionState {\n  // 44-characters long\n  id: string;\n  userId: string|number|null;\n  content: { [key: string]: any };\n  flash: { [key: string]: any };\n  // 4-bytes long (min: 0, max: 2147483647)\n  updatedAt: number;\n  // 4-bytes long (min: 0, max: 2147483647)\n  createdAt: number;\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"usage-with-cookies-1",children:"Usage with Cookies"}),"\n",(0,o.jsx)(n.h4,{id:"do-not-auto-create-the-session",children:"Do not Auto-Create the Session"}),"\n",(0,o.jsxs)(n.p,{children:["By default, when the ",(0,o.jsx)(n.code,{children:"cookie"})," option is set to true, the ",(0,o.jsx)(n.code,{children:"@UseSessions"})," hook automatically creates a session if it does not already exist. This can be disabled with the ",(0,o.jsx)(n.code,{children:"create"})," option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, createSession, dependency, HttpResponseOK, Post, Store, UseSessions } from '@foal/core';\n\nexport class ApiController {\n  @dependency\n  store: Store;\n\n  @Post('/login')\n  @UseSessions({ cookie: true, create: false })\n  async login(ctx: Context) {\n    // Check the credentials...\n\n    // ctx.session is potentially undefined\n    if (!ctx.session) {\n      ctx.session = await createSession(this.store);\n    }\n\n    return new HttpResponseOK();\n  }\n\n}\n"})}),"\n",(0,o.jsx)(n.h4,{id:"override-the-cookie-options",children:"Override the Cookie Options"}),"\n",(0,o.jsx)(n.p,{children:"The default session cookie directives can be overridden in the configuration as follows:"}),"\n",(0,o.jsxs)(r.A,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],children:[(0,o.jsx)(a.A,{value:"yaml",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"settings:\n  session:\n    cookie:\n      name: xxx # default: sessionID\n      domain: example.com\n      httpOnly: false # default: true\n      path: /foo # default: /\n      sameSite: lax\n      secure: true\n"})})}),(0,o.jsx)(a.A,{value:"json",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "settings": {\n    "session": {\n      "cookie": {\n        "name": "xxx",\n        "domain": "example.com",\n        "httpOnly": false,\n        "path": "/foo",\n        "sameSite": "lax",\n        "secure": true\n      }\n    }\n  }\n}\n'})})}),(0,o.jsx)(a.A,{value:"js",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'module.exports = {\n  settings: {\n    session: {\n      cookie: {\n        name: "xxx", // default: sessionID\n        domain: "example.com",\n        httpOnly: false, // default: true\n        path: "/foo", // default: /\n        sameSite: "lax",\n        secure: true\n      }\n    }\n  }\n}\n'})})})]}),"\n",(0,o.jsx)(n.h4,{id:"require-the-cookie",children:"Require the Cookie"}),"\n",(0,o.jsxs)(n.p,{children:["In rare situations, you may want to return a 400 error or redirect the user if no session cookie already exists on the client. If so, you can use the ",(0,o.jsx)(n.code,{children:"required"})," option to do so."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Get, HttpResponseOK, UseSessions } from '@foal/core';\n\nexport class ApiController {\n\n  @Get('/products')\n  @UseSessions({ cookie: true, required: true })\n  readProducts() {\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"read-a-session-from-a-token",children:"Read a Session From a Token"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"@UseSessions"})," hook automatically retrieves the session state on each request. If you need to manually read a session (for example in a shell script), you can do it with the ",(0,o.jsx)(n.code,{children:"readSession"})," function."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { readSession } from '@foal/core';\n\nconst session = await readSession(store, token);\nif (!session) {\n  throw new Error('Session does not exist or has expired.')\n}\nconst foo = session.get('foo');\n"})}),"\n",(0,o.jsx)(n.h3,{id:"save-manually-a-session",children:"Save Manually a Session"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"@UseSessions"})," hook automatically saves the session state on each request. If you need to manually save a session (for example in a shell script), you can do it with the ",(0,o.jsx)(n.code,{children:"commit"})," method."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"await session.commit();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"provide-a-custom-client-to-use-in-the-stores",children:"Provide A Custom Client to Use in the Stores"}),"\n",(0,o.jsxs)(n.p,{children:["By default, the ",(0,o.jsx)(n.code,{children:"MongoDBStore"})," and ",(0,o.jsx)(n.code,{children:"RedisStore"})," create a new client to connect to their respective databases."]}),"\n",(0,o.jsx)(n.p,{children:"This behavior can be overridden by providing a custom client to the stores at initialization."}),"\n",(0,o.jsx)(n.h4,{id:"redisstore-1",children:(0,o.jsx)(n.code,{children:"RedisStore"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm install redis@4\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"index.ts"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { createApp, ServiceManager } from '@foal/core';\nimport { RedisStore } from '@foal/redis';\nimport { createClient } from 'redis';\n\nasync function main() {\n  const redisClient = createClient({ url: 'redis://localhost:6379' });\n  await redisClient.connect();\n\n\n  const serviceManager = new ServiceManager();\n  serviceManager.get(RedisStore).setRedisClient(redisClient);\n\n  const app = await createApp(AppController, { serviceManager });\n\n  // ...\n}\n"})}),"\n",(0,o.jsx)(n.h4,{id:"mongodbstore-1",children:(0,o.jsx)(n.code,{children:"MongoDBStore"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm install mongodb@5\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"index.ts"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { createApp, ServiceManager } from '@foal/core';\nimport { MongoDBStore } from '@foal/mongodb';\nimport { MongoClient } from 'mongodb';\n\nasync function main() {\n  const mongoDBClient = await MongoClient.connect('mongodb://localhost:27017/db');\n\n  const serviceManager = new ServiceManager();\n  serviceManager.get(MongoDBStore).setMongoDBClient(mongoDBClient);\n\n  const app = await createApp(AppController, { serviceManager });\n\n  // ...\n}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},65537:(e,n,s)=>{s.d(n,{A:()=>S});var t=s(96540),o=s(34164),i=s(65627),r=s(56347),a=s(50372),c=s(30604),l=s(11861),d=s(78749);function h(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:s}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:s,attributes:t,default:o}}=e;return{value:n,label:s,attributes:t,default:o}}))}(s);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,s])}function p(e){let{value:n,tabValues:s}=e;return s.some((e=>e.value===n))}function x(e){let{queryString:n=!1,groupId:s}=e;const o=(0,r.W6)(),i=function(e){let{queryString:n=!1,groupId:s}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:n,groupId:s});return[(0,c.aZ)(i),(0,t.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(o.location.search);n.set(i,e),o.replace({...o.location,search:n.toString()})}),[i,o])]}function m(e){const{defaultValue:n,queryString:s=!1,groupId:o}=e,i=u(e),[r,c]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:s}=e;if(0===s.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:s}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${s.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=s.find((e=>e.default))??s[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i}))),[l,h]=x({queryString:s,groupId:o}),[m,j]=function(e){let{groupId:n}=e;const s=function(e){return e?`docusaurus.tab.${e}`:null}(n),[o,i]=(0,d.Dv)(s);return[o,(0,t.useCallback)((e=>{s&&i.set(e)}),[s,i])]}({groupId:o}),g=(()=>{const e=l??m;return p({value:e,tabValues:i})?e:null})();(0,a.A)((()=>{g&&c(g)}),[g]);return{selectedValue:r,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);c(e),h(e),j(e)}),[h,j,i]),tabValues:i}}var j=s(9136);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=s(74848);function y(e){let{className:n,block:s,selectedValue:t,selectValue:r,tabValues:a}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),d=e=>{const n=e.currentTarget,s=c.indexOf(n),o=a[s].value;o!==t&&(l(n),r(o))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const s=c.indexOf(e.currentTarget)+1;n=c[s]??c[0];break}case"ArrowLeft":{const s=c.indexOf(e.currentTarget)-1;n=c[s]??c[c.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":s},n),children:a.map((e=>{let{value:n,label:s,attributes:i}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>{c.push(e)},onKeyDown:h,onClick:d,...i,className:(0,o.A)("tabs__item",g.tabItem,i?.className,{"tabs__item--active":t===n}),children:s??n},n)}))})}function v(e){let{lazy:n,children:s,selectedValue:i}=e;const r=(Array.isArray(s)?s:[s]).filter(Boolean);if(n){const e=r.find((e=>e.props.value===i));return e?(0,t.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function b(e){const n=m(e);return(0,f.jsxs)("div",{className:(0,o.A)("tabs-container",g.tabList),children:[(0,f.jsx)(y,{...n,...e}),(0,f.jsx)(v,{...n,...e})]})}function S(e){const n=(0,j.A)();return(0,f.jsx)(b,{...e,children:h(e.children)},String(n))}},79329:(e,n,s)=>{s.d(n,{A:()=>r});s(96540);var t=s(34164);const o={tabItem:"tabItem_Ymn6"};var i=s(74848);function r(e){let{children:n,hidden:s,className:r}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,t.A)(o.tabItem,r),hidden:s,children:n})}},89932:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/user-cookie-c3f0e06d9ced0800240ac2b5ee368b8c.png"}}]);