"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7725],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var r=t(96540);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}},32987:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"authentication/jwt","title":"Authentication with JWT","description":"JSON Web Token (JWT) is an open standard (RFC 7519) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the HMAC algorithm) or a public/private key pair using RSA or ECDSA.","source":"@site/docs/authentication/jwt.md","sourceDirName":"authentication","slug":"/authentication/jwt","permalink":"/docs/authentication/jwt","draft":false,"unlisted":false,"editUrl":"https://github.com/FoalTS/foal/edit/master/docs/docs/authentication/jwt.md","tags":[],"version":"current","frontMatter":{"title":"Authentication with JWT","sidebar_label":"JSON Web Tokens"},"sidebar":"someSidebar","previous":{"title":"Session Tokens","permalink":"/docs/authentication/session-tokens"},"next":{"title":"Social Auth","permalink":"/docs/authentication/social-auth"}}');var s=t(74848),i=t(28453),o=t(65537),a=t(79329);const l={title:"Authentication with JWT",sidebar_label:"JSON Web Tokens"},c=void 0,d={},h=[{value:"Generate &amp; Provide a Secret",id:"generate--provide-a-secret",level:2},{value:"Generate &amp; Send Temporary Tokens",id:"generate--send-temporary-tokens",level:2},{value:"Example of a <code>LoginController</code>",id:"example-of-a-logincontroller",level:3},{value:"Receive &amp; Verify Tokens",id:"receive--verify-tokens",level:2},{value:"Advanced",id:"advanced",level:2},{value:"Blacklist Tokens",id:"blacklist-tokens",level:3},{value:"Refresh the tokens",id:"refresh-the-tokens",level:3},{value:"Make a Database Call to Get More User Properties",id:"make-a-database-call-to-get-more-user-properties",level:3},{value:"Specifying a Different Encoding for Secrets",id:"specifying-a-different-encoding-for-secrets",level:3},{value:"Usage with Cookies",id:"usage-with-cookies",level:3},{value:"Cookie options",id:"cookie-options",level:4},{value:"Use RSA or ECDSA public/private keys",id:"use-rsa-or-ecdsa-publicprivate-keys",level:3},{value:"Provide the Public and Private Keys",id:"provide-the-public-and-private-keys",level:4},{value:"Generate Temporary Tokens",id:"generate-temporary-tokens",level:3},{value:"Receive &amp; Verify Tokens",id:"receive--verify-tokens-1",level:4},{value:"Audience, Issuer and Other Options",id:"audience-issuer-and-other-options",level:3},{value:"Retreive a Dynamic Secret Or Public Key",id:"retreive-a-dynamic-secret-or-public-key",level:3},{value:"Retreive a Public Key from a JWKS endpoint",id:"retreive-a-public-key-from-a-jwks-endpoint",level:4},{value:"Auth0 and AWS Cognito (examples)",id:"auth0-and-aws-cognito-examples",level:3},{value:"Hook Errors",id:"hook-errors",level:2}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm install jsonwebtoken @foal/jwt\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"JSON Web Token (JWT) is an open standard (RFC 7519) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the HMAC algorithm) or a public/private key pair using RSA or ECDSA."})}),"\n",(0,s.jsxs)(n.p,{children:["Source: ",(0,s.jsx)(n.a,{href:"https://jwt.io/introduction/",children:"https://jwt.io/introduction/"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Foal offers a package, named ",(0,s.jsx)(n.code,{children:"@foal/jwt"}),", to manage authentication / authorization with JSON Web Tokens. When the user logs in, a token is generated and sent to the client. Then, each subsequent request must include this JWT, allowing the user to access routes, services, and resources that are permitted with that token."]}),"\n",(0,s.jsx)(n.h2,{id:"generate--provide-a-secret",children:"Generate & Provide a Secret"}),"\n",(0,s.jsxs)(n.p,{children:["In order to use JWTs, you must provide a secret to ",(0,s.jsx)(n.em,{children:"sign"})," your tokens. If you do not already have your own, you can generate one with the ",(0,s.jsx)(n.code,{children:"npx foal createsecret"})," command."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npx foal createsecret\nAk0WcVcGuOoFuZ4oqF1tgqbW6dIAeSacIN6h7qEyJM8=\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Alternatively you can use a public/private key pair to sign your tokens. In this case, please refer to the ",(0,s.jsx)(n.a,{href:"#Use-RSA-or-ECDSA-public/private-keys",children:"advanced section"})," below."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Once the secret is in hand, there are several ways to provide it to the future hooks:"}),"\n",(0,s.jsxs)(o.A,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],children:[(0,s.jsx)(a.A,{value:"yaml",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'settings:\n  jwt:\n    secret: "Ak0WcVcGuOoFuZ4oqF1tgqbW6dIAeSacIN6h7qEyJM8="\n    secretEncoding: base64\n'})})}),(0,s.jsx)(a.A,{value:"json",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "settings": {\n    "jwt": {\n      "secret": "Ak0WcVcGuOoFuZ4oqF1tgqbW6dIAeSacIN6h7qEyJM8=",\n      "secretEncoding": "base64"\n    }\n  }\n}\n'})})}),(0,s.jsx)(a.A,{value:"js",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'module.exports = {\n  settings: {\n    jwt: {\n      secret: "Ak0WcVcGuOoFuZ4oqF1tgqbW6dIAeSacIN6h7qEyJM8=",\n      secretEncoding: "base64"\n    }\n  }\n}\n'})})})]}),"\n",(0,s.jsx)(n.h2,{id:"generate--send-temporary-tokens",children:"Generate & Send Temporary Tokens"}),"\n",(0,s.jsx)(n.p,{children:"JSON Web Tokens are generated from JavaScript objects that usually contain information about the user."}),"\n",(0,s.jsx)(n.p,{children:"The below example shows how to generate a one-hour token using a secret."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { getSecretOrPrivateKey } from '@foal/jwt';\nimport { sign } from 'jsonwebtoken';\n\nconst token = sign(\n  {\n    sub: '90485234',\n    id: 90485234,\n    email: 'mary@foalts.org'\n  },\n  getSecretOrPrivateKey(),\n  { expiresIn: '1h' }\n);\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"getSecretOrPrivateKey"})," function tries to read the configurations ",(0,s.jsx)(n.code,{children:"settings.jwt.secret"})," and ",(0,s.jsx)(n.code,{children:"settings.jwt.privateKey"}),". It throws an error if not value is provided. The function ",(0,s.jsx)(n.code,{children:"getSecretOrPublicKey"})," works similarly."]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"subject"})," property (or ",(0,s.jsx)(n.code,{children:"sub"}),") is only required when ",(0,s.jsx)(n.a,{href:"#make-a-database-call-to-get-more-user-properties",children:"making a database call to get more user properties"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Each token should have an expiration time. Otherwise, the JWT will be valid indefinitely, which will raise security issues."}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"example-of-a-logincontroller",children:["Example of a ",(0,s.jsx)(n.code,{children:"LoginController"})]}),"\n",(0,s.jsx)(n.p,{children:"The below example shows how to implement a login controller with an email and a password."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"login.controller.ts"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {\n  Config, Context, HttpResponseOK, HttpResponseUnauthorized,\n  Post, ValidateBody, verifyPassword\n} from '@foal/core';\nimport { getSecretOrPrivateKey } from '@foal/jwt';\nimport { sign } from 'jsonwebtoken';\n\nimport { User } from '../entities';\n\nexport class LoginController {\n\n  @Post('/login')\n  @ValidateBody({\n    additionalProperties: false,\n    properties: {\n      email: { type: 'string', format: 'email' },\n      password: { type: 'string' }\n    },\n    required: [ 'email', 'password' ],\n    type: 'object',\n  })\n  async login(ctx: Context) {\n    const user = await User.findOneBy({ email: ctx.request.body.email });\n\n    if (!user) {\n      return new HttpResponseUnauthorized();\n    }\n\n    if (!await verifyPassword(ctx.request.body.password, user.password)) {\n      return new HttpResponseUnauthorized();\n    }\n\n    const token = sign(\n      { email: user.email },\n      getSecretOrPrivateKey(),\n      { expiresIn: '1h' }\n    );\n\n    return new HttpResponseOK({ token });\n  }\n\n}\n\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"user.entity.ts"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { hashPassword } from '@foal/core';\nimport { BaseEntity, Column, Entity, PrimaryGeneratedColumn } from 'typeorm';\n\n@Entity()\nexport class User extends BaseEntity {\n\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column({ unique: true })\n  email: string;\n\n  @Column()\n  password: string;\n\n  async setPassword(password: string) {\n    this.password = await hashPassword(password);\n  }\n\n}\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"receive--verify-tokens",children:"Receive & Verify Tokens"}),"\n",(0,s.jsxs)(n.p,{children:["Foal provides two hooks to authenticate users upon subsequent requests: ",(0,s.jsx)(n.code,{children:"JWTOptional"})," and ",(0,s.jsx)(n.code,{children:"JWTRequired"}),". They both expect the client to send the JWT in the ",(0,s.jsx)(n.strong,{children:"Authorization"})," header using the ",(0,s.jsx)(n.strong,{children:"Bearer"})," schema."]}),"\n",(0,s.jsx)(n.p,{children:"In other words, the content of the header should look like the following:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Authorization: Bearer <token>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If no token is provided, the ",(0,s.jsx)(n.code,{children:"JWTRequired"})," hook returns an error ",(0,s.jsx)(n.em,{children:"400 - BAD REQUEST"})," while ",(0,s.jsx)(n.code,{children:"JWTOptional"})," does nothing."]}),"\n",(0,s.jsxs)(n.p,{children:["If a token is provided and valid, the hooks set the ",(0,s.jsx)(n.code,{children:"Context.user"})," with the decoded payload (default behavior)."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Context, Get, HttpResponseOK } from '@foal/core';\nimport { JWTRequired } from '@foal/jwt';\n\n@JWTRequired()\nexport class ApiController {\n\n  @Get('/products')\n  readProducts(ctx: Context) {\n    console.log(ctx.user);\n    return new HttpResponseOK([]);\n  }\n\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"advanced",children:"Advanced"}),"\n",(0,s.jsx)(n.h3,{id:"blacklist-tokens",children:"Blacklist Tokens"}),"\n",(0,s.jsxs)(n.p,{children:["In the event that a jwt has been stolen by an attacker, the application must be able to revoke the compromised token. This can be done by establishing a ",(0,s.jsx)(n.em,{children:"black list"}),". Revoked tokens are no longer considered valid and the hooks return a 401 error - UNAUTHORIZED when they receive one."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { isInFile } from '@foal/core';\nimport { JWTRequired } from '@foal/jwt';\n\n@JWTRequired({ blackList: isInFile('./blacklist.txt') })\nexport class ApiController {\n  // ...\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"isInFile"})," function takes a token and returns a boolean specifying if the token is revoked or not."]}),"\n",(0,s.jsx)(n.p,{children:"You can provide your own function (in the case you want to use a cache database for example). This function must have this signature:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"(token: string) => boolean|Promise<boolean>;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"refresh-the-tokens",children:"Refresh the tokens"}),"\n",(0,s.jsx)(n.p,{children:"Having a too-long expiration date for JSON Web Tokens is not recommend as it increases exposure to attacks based on token hijacking. If an attacker succeeds in stealing a token with an insufficient expiration date, he/she will have plenty of time to make other attacks and harm your application."}),"\n",(0,s.jsx)(n.p,{children:"In order to minimize the exposure, it is recommend to set a short expiration date (15 minutes for common applications) to quickly invalidate tokens. In this way, even if a token is stolen, it will quickly become unusable since it will have expired."}),"\n",(0,s.jsx)(n.p,{children:"One of the disadvantages of having short expiration dates, however, is that users get logged out too often which is not very user-friendly."}),"\n",(0,s.jsx)(n.p,{children:"One way to get around this problem is to generate and send a new token on each request. The client then saves this new token and uses it on further requests. In this way, if users are inactive more than 15 minutes, they are disconnected. Otherwise, the user will still be connected but the application will use a different token."}),"\n",(0,s.jsxs)(n.p,{children:["The below code shows how to implement this technique with a hook. On each request, the client will receive a new token in the ",(0,s.jsx)(n.code,{children:"Authorization"})," header of the response. Other implementations are still possible (especially if you use cookies)."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Note that when a new token is generated, the previous one is still valid until its expiration date."})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"refresh-jwt.hook.ts (example)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Hook, HookDecorator, HttpResponse, isHttpResponseServerError } from '@foal/core';\nimport { getSecretOrPrivateKey } from '@foal/jwt';\nimport { sign } from 'jsonwebtoken';\n\nexport function RefreshJWT(): HookDecorator {\n  return Hook(ctx => {\n    if (!ctx.user) {\n      return;\n    }\n\n    return (response: HttpResponse) => {\n      if (isHttpResponseServerError(response)) {\n        return;\n      }\n\n      const newToken = sign(\n        // The below object assumes that ctx.user is\n        // the decoded payload (default behavior).\n        {\n          email: ctx.user.email,\n          // id: ctx.user.id,\n          // sub: ctx.user.subject,\n        },\n        getSecretOrPrivateKey(),\n        { expiresIn: '15m' }\n      );\n      response.setHeader('Authorization', newToken);\n    };\n\n  });\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"api.controller.ts (example)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@JWTRequired()\n@RefreshJWT()\nexport class ApiController {\n  // ...\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"make-a-database-call-to-get-more-user-properties",children:"Make a Database Call to Get More User Properties"}),"\n",(0,s.jsxs)(n.p,{children:["In several cases, the decoded payload is not sufficient. We may need to fetch extra properties from the database, such as the user permissions for example, or simply want the ",(0,s.jsx)(n.code,{children:"Context.user"})," to a be a model instance instead of a plain object."]}),"\n",(0,s.jsxs)(n.p,{children:["In these cases, the two hooks ",(0,s.jsx)(n.code,{children:"JWTRequired"})," and ",(0,s.jsx)(n.code,{children:"JWTOptional"})," offer a ",(0,s.jsx)(n.code,{children:"user"})," option to transform the decoded payload into something else. To do this,"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Each JSON Web Token must have a ",(0,s.jsx)(n.code,{children:"subject"})," property (or ",(0,s.jsx)(n.code,{children:"sub"}),") which is a string containing the user id. If the id is a number, it must be converted to a string using, for example, the ",(0,s.jsx)(n.code,{children:"toString()"})," method."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { getSecretOrPrivateKey } from '@foal/jwt';\nimport { sign } from 'jsonwebtoken';\n\nconst token = sign(\n  {\n    // TypeScript v3.5.1 and v3.5.2 have a bug which makes the compilation fail\n    // with the property \"sub\". This can be fixed by adding \"as any\" after the object.\n    sub: '90485234', // Required\n    id: 90485234,\n    email: 'mary@foalts.org'\n  },\n  getSecretOrPrivateKey(),\n  { expiresIn: '1h' }\n);\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The hook must be provided a function that takes a string id (the ",(0,s.jsx)(n.code,{children:"subject"}),") as parameter and returns the value of the ",(0,s.jsx)(n.code,{children:"Context.user"}),". If the function returns ",(0,s.jsx)(n.code,{children:"undefined"}),", the hooks returns an error ",(0,s.jsx)(n.em,{children:"401 - UNAUTHORIZED"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example with TypeORM (SQL database)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Context, Get } from '@foal/core';\nimport { JWTRequired } from '@foal/jwt';\n\nimport { User } from '../entities';\n\n@JWTRequired({ user: (id: number) => User.findOneBy({ id }) })\nexport class ApiController {\n  @Get('/do-something')\n  get(ctx: Context) {\n    // ctx.user is the instance returned by User.findOneBy.\n    // ...\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example with TypeORM (MongoDB)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Context, Get } from '@foal/core';\nimport { JWTRequired } from '@foal/jwt';\nimport { ObjectId } from 'mongodb';\n\nimport { User } from '../entities';\n\n@JWTRequired({\n  userIdType: 'string',\n  user: (id: string) => User.findOneBy({ _id: new ObjectId(id) }),\n})\nexport class ApiController {\n  @Get('/do-something')\n  get(ctx: Context) {\n    // ctx.user is the instance returned by User.findOneBy.\n    // ...\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example with a custom function"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Context, Get } from '@foal/core';\nimport { JWTRequired } from '@foal/jwt';\n\nconst users = [\n  { id: 1, email: 'mary@foalts.org', isAdmin: true },\n  { id: 2, email: 'john@foalts.org', isAdmin: false },\n];\n\nfunction getUserById(id: number) {\n  return users.find(user => user.id === id);\n}\n\n@JWTRequired({ user: getUserById })\nexport class ApiController {\n  @Get('/do-something')\n  get(ctx: Context) {\n    // ctx.user is an item of the `users` array.\n    // ...\n  }\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"specifying-a-different-encoding-for-secrets",children:"Specifying a Different Encoding for Secrets"}),"\n",(0,s.jsxs)(n.p,{children:["By default, UTF-8 is used to encode the secret string into bytes when verifying the token. However, you can use another character encoding with the ",(0,s.jsx)(n.code,{children:"settings.jwt.secretEncoding"})," configuration key."]}),"\n",(0,s.jsxs)(n.p,{children:["Available encodings are listed ",(0,s.jsx)(n.a,{href:"https://nodejs.org/api/buffer.html#buffer_buffers_and_character_encodings",children:"here"}),"."]}),"\n",(0,s.jsxs)(o.A,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],children:[(0,s.jsx)(a.A,{value:"yaml",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"settings:\n  jwt:\n    secret: HEwh0TW7w6a5yUwIrpHilUqetAqTFAVSHx2rg6DWNtg=\n    secretEncoding: base64\n"})})}),(0,s.jsx)(a.A,{value:"json",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "settings": {\n    "jwt": {\n      "secret": "HEwh0TW7w6a5yUwIrpHilUqetAqTFAVSHx2rg6DWNtg=",\n      "secretEncoding": "base64",\n    }\n  }\n}\n'})})}),(0,s.jsx)(a.A,{value:"js",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'module.exports = {\n  settings: {\n    jwt: {\n      secret: "HEwh0TW7w6a5yUwIrpHilUqetAqTFAVSHx2rg6DWNtg=",\n      secretEncoding: "base64",\n    }\n  }\n}\n'})})})]}),"\n",(0,s.jsx)(n.h3,{id:"usage-with-cookies",children:"Usage with Cookies"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Be aware that if you use cookies, your application must provide a ",(0,s.jsx)(n.a,{href:"/docs/security/csrf-protection",children:"CSRF defense"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["By default, the hooks expect the token to be sent in the ",(0,s.jsx)(n.strong,{children:"Authorization"})," header using the ",(0,s.jsx)(n.strong,{children:"Bearer"})," schema. But it is also possible to send the token in a cookie with the ",(0,s.jsx)(n.code,{children:"cookie"})," option."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"api.controller.ts"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { JWTRequired } from '@foal/jwt';\n\n@JWTRequired({ cookie: true })\nexport class ApiController {\n  // ...\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"auth.controller.ts"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"\nimport { setAuthCookie, removeAuthCookie } from '@foal/jwt';\n\nexport class AuthController {\n\n  @Post('/login')\n  async login(ctx: Context) {\n    // ...\n\n    const response = new HttpResponseNoContent();\n    // Do not forget the \"await\" keyword.\n    await setAuthCookie(response, token);\n    return response;\n  }\n\n  @Post('/logout')\n  logout(ctx: Context) {\n    // ...\n\n    const response = new HttpResponseNoContent();\n    removeAuthCookie(response);\n    return response;\n  }\n\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Note: the cookie expire date is equal to the JWT expire date."})}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"cookie-options",children:"Cookie options"}),"\n",(0,s.jsxs)(o.A,{defaultValue:"yaml",values:[{label:"YAML",value:"yaml"},{label:"JSON",value:"json"},{label:"JS",value:"js"}],children:[(0,s.jsx)(a.A,{value:"yaml",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"settings:\n  jwt:\n    cookie:\n      name: mycookiename # Default: auth\n      domain: example.com\n      httpOnly: true # Warning: unlike session tokens, the httpOnly directive has no default value.\n      path: /foo # Default: /\n      sameSite: strict # Default: lax if settings.jwt.csrf.enabled is true.\n      secure: true\n"})})}),(0,s.jsx)(a.A,{value:"json",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "settings": {\n    "jwt": {\n      "cookie": {\n        "name": "mycookiename",\n        "domain": "example.com",\n        "httpOnly": true,\n        "path": "/foo",\n        "sameSite": "strict",\n        "secure": true\n      }\n    }\n  }\n}\n'})})}),(0,s.jsx)(a.A,{value:"js",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'module.exports = {\n  settings: {\n    jwt: {\n      cookie: {\n        name: "mycookiename",\n        domain: "example.com",\n        httpOnly: true,\n        path: "/foo",\n        sameSite: "strict",\n        secure: true\n      }\n    }\n  }\n}\n'})})})]}),"\n",(0,s.jsx)(n.h3,{id:"use-rsa-or-ecdsa-publicprivate-keys",children:"Use RSA or ECDSA public/private keys"}),"\n",(0,s.jsx)(n.p,{children:"JWTs can also be signed using a public/private key pair using RSA or ECDSA."}),"\n",(0,s.jsx)(n.h4,{id:"provide-the-public-and-private-keys",children:"Provide the Public and Private Keys"}),"\n",(0,s.jsx)(n.p,{children:"First of all, specify in the configuration where the keys are stored."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"config/default.js"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const { Env } = require('@foal/core');\nconst { readFileSync } = require('fs');\n\nmodule.exports = {\n  settings: {\n    jwt: {\n      privateKey: Env.get('RSA_PRIVATE_KEY') || readFileSync('./id_rsa', 'utf8'),\n      publicKey: Env.get('RSA_PUBLIC_KEY') || readFileSync('./id_rsa.pub', 'utf8'),\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then you can provide the keys in RSA files (",(0,s.jsx)(n.code,{children:"id_rsa"})," and ",(0,s.jsx)(n.code,{children:".id_rsa/pub"}),") or in environment variables."]}),"\n",(0,s.jsx)(n.h3,{id:"generate-temporary-tokens",children:"Generate Temporary Tokens"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Config } from '@foal/core';\nimport { getSecretOrPrivateKey } from '@foal/jwt';\nimport { sign } from 'jsonwebtoken';\n\nconst token = sign(\n  {\n    email: 'john@foalts.org'\n  },\n  getSecretOrPrivateKey(),\n  { expiresIn: '1h', algorithm: 'RS256' }\n);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"receive--verify-tokens-1",children:"Receive & Verify Tokens"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example with RSA"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { JWTRequired } from '@foal/jwt';\n\n@JWTRequired({}, { algorithm: 'RS256' })\nexport class ApiController {\n  // ...\n}\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"audience-issuer-and-other-options",children:"Audience, Issuer and Other Options"}),"\n",(0,s.jsxs)(n.p,{children:["The second parameter of ",(0,s.jsx)(n.code,{children:"JWTOptional"})," and ",(0,s.jsx)(n.code,{children:"JWTRequired"})," allows to specify the required audience or issuer as well as other properties. It is passed as options to the ",(0,s.jsx)(n.code,{children:"verify"})," function of the ",(0,s.jsx)(n.a,{href:"https://www.npmjs.com/package/jsonwebtoken",children:"jsonwebtoken"})," library."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example checking the audience"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { JWTRequired } from '@foal/jwt';\n\n@JWTRequired({}, { audience: [ /urn:f[o]{2}/, 'urn:bar' ] })\nexport class ApiController {\n  // ...\n}\n\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example checking the issuer"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { JWTRequired } from '@foal/jwt';\n\n@JWTRequired({}, { issuer: 'foo' })\nexport class ApiController {\n  // ...\n}\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"retreive-a-dynamic-secret-or-public-key",children:"Retreive a Dynamic Secret Or Public Key"}),"\n",(0,s.jsxs)(n.p,{children:["By default ",(0,s.jsx)(n.code,{children:"JWTRequired"})," and ",(0,s.jsx)(n.code,{children:"JWTOptional"})," use the value of the configuration keys ",(0,s.jsx)(n.code,{children:"settings.jwt.secret"})," or ",(0,s.jsx)(n.code,{children:"settings.jwt.publicKey"})," as a static secret (or public key)."]}),"\n",(0,s.jsxs)(n.p,{children:["But it is also possible to dynamically retrieve a key to verify the token. To do so, you can specify a function with the below signature to the ",(0,s.jsx)(n.code,{children:"secretOrPublicKey"})," option."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"(header: any, payload: any) => Promise<string>;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { JWTRequired } from '@foal/jwt';\n\n@JWTRequired({\n  secretOrPublicKey: async (header, payload) => {\n    // ...\n    return 'my-secret';\n  }\n})\nexport class ApiController {\n  // ...\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If needed, this function can throw an ",(0,s.jsx)(n.code,{children:"InvalidTokenError"})," to return a 401 error to the client."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { JWTRequired } from '@foal/jwt';\n\n@JWTRequired({\n  secretOrPublicKey: async (header, payload) => {\n    if (header.alg !== 'RS256') {\n      throw new InvalidTokenError('invalid algorithm');\n    }\n    return 'my-secret';\n  }\n})\nexport class ApiController {\n  // ...\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In the above example, if the algorithm specified in the token is not ",(0,s.jsx)(n.code,{children:"RS256"}),", then the server will respond a ",(0,s.jsx)(n.code,{children:"401 - UNAUTHORIZED"})," error with this content:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"{\n  code: 'invalid_token',\n  description: 'invalid algorithm'\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"retreive-a-public-key-from-a-jwks-endpoint",children:"Retreive a Public Key from a JWKS endpoint"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm install @foal/jwks-rsa\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"getRSAPublicKeyFromJWKS"})," allows you to retreive a public key from a JWKS endpoint. It is based on the ",(0,s.jsxs)(n.a,{href:"https://github.com/auth0/node-jwks-rsa",children:[(0,s.jsx)(n.code,{children:"jwks-rsa"})," library"]}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Example"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { JWTRequired } from '@foal/jwt';\n\n@JWTRequired({\n  secretOrPublicKey: getRSAPublicKeyFromJWKS({\n    cache: true,\n    cacheMaxEntries: 5, // Default value\n    cacheMaxAge: ms('10h'), // Default value\n    jwksUri: 'http://localhost:3000/.well-known/jwks.json',\n  })\n})\nexport class ApiController {\n  // ...\n}\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"auth0-and-aws-cognito-examples",children:"Auth0 and AWS Cognito (examples)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm install @foal/jwks-rsa\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Auth0 & AWS Cognito are both platforms to manage authentication & authorization."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This section provides examples on how to decode and verify JWTs generated by these platforms (the ",(0,s.jsx)(n.code,{children:"id_token"}),"). It assumes that you are already familiar with them."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Auth0"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { JWTRequired } from '@foal/jwt';\n\n// These lines assume that you provided your DOMAIN and AUDIENCE in either\n// an .env file, in environment variables or in one the configuration file \n// in `config/`.\nconst domain = Config.getOrThrow('auth0.domain', 'string');\nconst audience = Config.getOrThrow('auth0.audience', 'string');\n\n@JWTRequired({\n  secretOrPublicKey: getRSAPublicKeyFromJWKS({\n    cache: true,\n    jwksRequestsPerMinute: 5,\n    jwksUri: `https://${domain}/.well-known/jwks.json`,\n    rateLimit: true,\n  })\n}, {\n  algorithms: [ 'RS256' ],\n  audience,\n  issuer: `https://${domain}/`,\n})\nexport class ApiController {\n  // ...\n}\n\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"AWS Cognito"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { JWTRequired } from '@foal/jwt';\n\n// These lines assume that you provided your CLIENT_ID, DOMAIN and USER_POOL_ID\n// in either an .env file, in environment variables or in one the configuration \n// file in `config/`.\nconst clientId = Config.getOrThrow('cognito.clientId', 'string');\nconst domain = Config.getOrThrow('cognito.domain', 'string');\nconst userPoolId = Config.getOrThrow('cognito.userPoolId', 'string');\n\n@JWTRequired({\n  secretOrPublicKey: getRSAPublicKeyFromJWKS({\n    cache: true,\n    jwksRequestsPerMinute: 5,\n    jwksUri: `https://cognito-idp.${region}.amazonaws.com/${userPoolId}/.well-known/jwks.json`,\n    rateLimit: true,\n  })\n}, {\n  algorithms: [ 'RS256' ],\n  audience: clientId,\n  issuer: `https://cognito-idp.${region}.amazonaws.com/${userPoolId}`,\n})\nexport class ApiController {\n  // ...\n}\n\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Note: The above example does not use a secret for simplicity."})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"hook-errors",children:"Hook Errors"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Error"}),(0,s.jsx)(n.th,{children:"Response Status"}),(0,s.jsx)(n.th,{children:"Response Body"}),(0,s.jsxs)(n.th,{children:[(0,s.jsx)(n.code,{children:"WWW-Authenticate"})," Response Header"]})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["No secret or public key is provided in ",(0,s.jsx)(n.code,{children:"default.json"})," or as environment variable."]}),(0,s.jsx)(n.td,{children:"500"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["The ",(0,s.jsx)(n.code,{children:"Authorization"})," header does not exist (only for ",(0,s.jsx)(n.code,{children:"JWTRequired"}),")."]}),(0,s.jsx)(n.td,{children:"400"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_request', description: 'Authorization header not found.' }"})}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["The auth cookie does not exist (only for ",(0,s.jsx)(n.code,{children:"JWTRequired"}),")."]}),(0,s.jsx)(n.td,{children:"400"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_request', description: 'Auth cookie not found.' }"})}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["The ",(0,s.jsx)(n.code,{children:"Authorization"})," header does use the Bearer scheme."]}),(0,s.jsx)(n.td,{children:"400"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_request', description: 'Expected a bearer token. Scheme is Authorization: Bearer <token>.' }"})}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"The token is black listed."}),(0,s.jsx)(n.td,{children:"401"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_token', description: 'jwt revoked' }"})}),(0,s.jsx)(n.td,{children:'error="invalid_token", error_description="jwt revoked"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"The token is not a JWT."}),(0,s.jsx)(n.td,{children:"401"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_token', description: 'jwt malformed' }"})}),(0,s.jsx)(n.td,{children:'error="invalid_token", error_description="jwt malformed"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"The signature is invalid."}),(0,s.jsx)(n.td,{children:"401"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_token', description: 'jwt signature' }"})}),(0,s.jsx)(n.td,{children:'error="invalid_token", error_description="jwt signature"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"The token is expired."}),(0,s.jsx)(n.td,{children:"401"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_token', description: 'jwt expired' }"})}),(0,s.jsx)(n.td,{children:'error="invalid_token", error_description="jwt expired"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"The audience is not expected."}),(0,s.jsx)(n.td,{children:"401"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_token', description: 'jwt audience invalid. expected: xxx' }"})}),(0,s.jsx)(n.td,{children:'error="invalid_token", error_description="jwt audience invalid. expected: xxx"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"The issuer is not expected."}),(0,s.jsx)(n.td,{children:"401"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_token', description: 'jwt issuer invalid. expected: xxx' }"})}),(0,s.jsx)(n.td,{children:'error="invalid_token", error_description="jwt issuer invalid. expected: xxx"'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["There is no subject claim and ",(0,s.jsx)(n.code,{children:"options.user"})," is defined."]}),(0,s.jsx)(n.td,{children:"401"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_token', description: 'The token must include a subject which is the id of the user.' }"})}),(0,s.jsx)(n.td,{children:'error="invalid_token", error_description="The token must include a subject which is the id of the user."'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"options.user"})," is defined and no user was found from its value (function)."]}),(0,s.jsx)(n.td,{children:"401"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"{ code: 'invalid_token', description: 'The token subject does not match any user.' }"})}),(0,s.jsx)(n.td,{children:'error="invalid_token", error_description="The token subject does not match any user."'})]})]})]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},65537:(e,n,t)=>{t.d(n,{A:()=>k});var r=t(96540),s=t(34164),i=t(65627),o=t(56347),a=t(50372),l=t(30604),c=t(11861),d=t(78749);function h(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:s}}=e;return{value:n,label:t,attributes:r,default:s}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function x(e){let{queryString:n=!1,groupId:t}=e;const s=(0,o.W6)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(s.location.search);n.set(i,e),s.replace({...s.location,search:n.toString()})}),[i,s])]}function j(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,i=u(e),[o,l]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:i}))),[c,h]=x({queryString:t,groupId:s}),[j,m]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,i]=(0,d.Dv)(t);return[s,(0,r.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:s}),f=(()=>{const e=c??j;return p({value:e,tabValues:i})?e:null})();(0,a.A)((()=>{f&&l(f)}),[f]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),m(e)}),[h,m,i]),tabValues:i}}var m=t(9136);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=t(74848);function v(e){let{className:n,block:t,selectedValue:r,selectValue:o,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),d=e=>{const n=e.currentTarget,t=l.indexOf(n),s=a[t].value;s!==r&&(c(n),o(s))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},n),children:a.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>{l.push(e)},onKeyDown:h,onClick:d,...i,className:(0,s.A)("tabs__item",f.tabItem,i?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function y(e){let{lazy:n,children:t,selectedValue:i}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===i));return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function b(e){const n=j(e);return(0,g.jsxs)("div",{className:(0,s.A)("tabs-container",f.tabList),children:[(0,g.jsx)(v,{...n,...e}),(0,g.jsx)(y,{...n,...e})]})}function k(e){const n=(0,m.A)();return(0,g.jsx)(b,{...e,children:h(e.children)},String(n))}},79329:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);var r=t(34164);const s={tabItem:"tabItem_Ymn6"};var i=t(74848);function o(e){let{children:n,hidden:t,className:o}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,o),hidden:t,children:n})}}}]);