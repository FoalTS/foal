"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7329],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>c});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(a),c=r,k=m["".concat(s,".").concat(c)]||m[c]||d[c]||o;return a?n.createElement(k,i(i({ref:t},u),{},{components:a})):n.createElement(k,i({ref:t},u))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},87857:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const o={title:"TypeORM",sidebar_label:"Introduction"},i=void 0,l={unversionedId:"databases/typeorm/introduction",id:"databases/typeorm/introduction",title:"TypeORM",description:"A simple model:",source:"@site/docs/databases/typeorm/introduction.md",sourceDirName:"databases/typeorm",slug:"/databases/typeorm/introduction",permalink:"/docs/databases/typeorm/introduction",draft:!1,editUrl:"https://github.com/FoalTS/foal/edit/master/docs/docs/databases/typeorm/introduction.md",tags:[],version:"current",frontMatter:{title:"TypeORM",sidebar_label:"Introduction"},sidebar:"someSidebar",previous:{title:"ExpressJS",permalink:"/docs/common/expressjs"},next:{title:"Models & Queries",permalink:"/docs/databases/typeorm/create-models-and-queries"}},s={},p=[{value:"The ORM",id:"the-orm",level:2},{value:"Supported Databases",id:"supported-databases",level:2},{value:"Use with FoalTS",id:"use-with-foalts",level:2},{value:"Initial Configuration",id:"initial-configuration",level:3},{value:"Packages",id:"packages",level:3},{value:"Database Configuration Examples",id:"database-configuration-examples",level:2},{value:"PostgreSQL",id:"postgresql",level:3},{value:"MySQL",id:"mysql",level:3},{value:"Configuration and Testing",id:"configuration-and-testing",level:2}],u={toc:p};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"A simple model:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Column, Entity, PrimaryGeneratedColumn } from 'typeorm';\n\n@Entity()\nexport class User {\n\n    @PrimaryGeneratedColumn()\n    id: number;\n\n    @Column()\n    firstName: string;\n\n    @Column()\n    lastName: string;\n\n}\n")),(0,r.kt)("h2",{id:"the-orm"},"The ORM"),(0,r.kt)("p",null,"FoalTS uses ",(0,r.kt)("a",{parentName:"p",href:"https://typeorm.io/"},"TypeORM")," as default ",(0,r.kt)("em",{parentName:"p"},"Object-Relational Mapping"),". This allows you to create classes to interact with your database tables (or collections). TypeORM is written in TypeScript and supports both ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Active_record_pattern"},"Active Record")," and ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Data_mapper_pattern"},"Data Mapper")," patterns."),(0,r.kt)("p",null,"Here is a non-exhaustive list of its features:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"migrations and automatic migrations generation"),(0,r.kt)("li",{parentName:"ul"},"uni-directional, bi-directional and self-referenced relations"),(0,r.kt)("li",{parentName:"ul"},"eager and lazy relations"),(0,r.kt)("li",{parentName:"ul"},"TypeScript support"),(0,r.kt)("li",{parentName:"ul"},"connection configuration in json / xml / yml / env formats"),(0,r.kt)("li",{parentName:"ul"},"transactions"),(0,r.kt)("li",{parentName:"ul"},"etc")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Although this documentation presents the basic features of TypeORM, you may be interested in reading the ",(0,r.kt)("a",{parentName:"p",href:"https://typeorm.io/"},"official documentation")," to learn more advanced features.")),(0,r.kt)("h2",{id:"supported-databases"},"Supported Databases"),(0,r.kt)("p",null,"FoalTS supports officially the following databases:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Database"),(0,r.kt)("th",{parentName:"tr",align:null},"Versions"),(0,r.kt)("th",{parentName:"tr",align:null},"Driver"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"PostgreSQL"),(0,r.kt)("td",{parentName:"tr",align:null},"9.6+ (",(0,r.kt)("a",{parentName:"td",href:"https://www.postgresql.org/support/versioning/"},"Version Policy"),")"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pg@8"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"MySQL"),(0,r.kt)("td",{parentName:"tr",align:null},"5.7+ (",(0,r.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/MySQL#Release_history"},"Version Policy"),")"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"mysql@2"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SQLite"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"sqlite3@5"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"MongoDB"),(0,r.kt)("td",{parentName:"tr",align:null},"4.0+ (",(0,r.kt)("a",{parentName:"td",href:"https://www.mongodb.com/support-policy"},"Version Policy"),")"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"mongodb@5"))))),(0,r.kt)("h2",{id:"use-with-foalts"},"Use with FoalTS"),(0,r.kt)("p",null,"TypeORM is integrated by default in each new FoalTS project. This allows you to quickly create models, run migrations and use the authentication system without wasting time on configuration. However, if you do not wish to use it, you can refer to the page ",(0,r.kt)("a",{parentName:"p",href:"/docs/databases/other-orm/introduction"},"Using another ORM"),"."),(0,r.kt)("h3",{id:"initial-configuration"},"Initial Configuration"),(0,r.kt)("p",null,"When creating a new project, an ",(0,r.kt)("inlineCode",{parentName:"p"},"SQLite")," database is used by default as it does not require any additional installation (the data is saved in a file). The connection configuration is stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"default.json")," located in the ",(0,r.kt)("inlineCode",{parentName:"p"},"config/")," directory."),(0,r.kt)("h3",{id:"packages"},"Packages"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"npm install typeorm@0.3.17 @foal/typeorm\n")),(0,r.kt)("p",null,"Two packages are required to use TypeORM with FoalTS:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The package ",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/typeorm"},"typeorm")," which is the official one of the ORM. It includes everything you need to create models and make database requests."),(0,r.kt)("li",{parentName:"ul"},"The package ",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@foal/typeorm"},"@foal/typeorm")," (maintained by FoalTS) which contains additional components. These are particularly useful when using FoalTS ",(0,r.kt)("a",{parentName:"li",href:"/docs/authentication/quick-start"},"authentication and authorization system"),".")),(0,r.kt)("h2",{id:"database-configuration-examples"},"Database Configuration Examples"),(0,r.kt)("h3",{id:"postgresql"},"PostgreSQL"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"npm install pg\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"config/default.json")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  // ...\n\n  "database": {\n    "type": "postgres",\n    "host": "localhost",\n    "port": 5432,\n    "username": "root",\n    "password": "password",\n    "database": "my-db"\n  }\n}\n')),(0,r.kt)("h3",{id:"mysql"},"MySQL"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"npm install mysql\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"config/default.json")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  // ...\n\n  "database": {\n    "type": "mysql",\n    "host": "localhost",\n    "port": 3306,\n    "username": "root",\n    "password": "password",\n    "database": "my-db"\n  }\n}\n')),(0,r.kt)("h2",{id:"configuration-and-testing"},"Configuration and Testing"),(0,r.kt)("p",null,"When running the command ",(0,r.kt)("inlineCode",{parentName:"p"},"npm run test")," with the above configuration, FoalTS will try to retrieve the database configuration in this order:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"config/test.yml")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"config/test.json"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"config/default.yml")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"config/default.json"),".")),(0,r.kt)("p",null,"In this way, you can define a default configuration in the ",(0,r.kt)("inlineCode",{parentName:"p"},"config/default.{yml|json}")," file to use both during development and testing and override some settings in ",(0,r.kt)("inlineCode",{parentName:"p"},"config/test.{yml|json}")," during testing."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You learn more on how configuration works in Foal ",(0,r.kt)("a",{parentName:"p",href:"/docs/architecture/configuration"},"here"))),(0,r.kt)("p",null,"In the example below, we add two new options:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dropSchema")," clears the database each time we create the connection"),(0,r.kt)("li",{parentName:"ul"},"and ",(0,r.kt)("inlineCode",{parentName:"li"},"synchronize")," synchronizes the database tables with your entities so your do not have to generate and run migrations during testing.")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"config/test.yml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# ...\n\ndatabase:\n  username: 'test'\n  password: 'test'\n  database: 'test'\n  dropSchema: true\n  sychronize: true\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Example of a test")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { DataSource } from 'typeorm';\nimport { createDataSource } from '../db';\n\ndescribe('xxx', () => {\n\n  let dataSource: DataSource;\n\n  beforeEach(async () => {\n    dataSource = createDataSource();\n    await dataSource.initialize();\n  });\n\n  afterEach(async () => {\n    if (dataSource) {\n      await dataSource.destroy()\n    }\n  });\n\n  it('yyy', () => {\n    // ...\n  });\n\n});\n")))}d.isMDXComponent=!0}}]);