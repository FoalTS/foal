"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8593],{85388:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>a});var r=n(74848),t=n(28453);const o={title:"CORS Requests",sidebar_label:"CORS"},i=void 0,c={id:"security/cors",title:"CORS Requests",description:"Building a public API requires to allow Cross-Origin Request Sharing.",source:"@site/versioned_docs/version-3.x/security/cors.md",sourceDirName:"security",slug:"/security/cors",permalink:"/docs/3.x/security/cors",draft:!1,unlisted:!1,editUrl:"https://github.com/FoalTS/foal/edit/master/docs/versioned_docs/version-3.x/security/cors.md",tags:[],version:"3.x",frontMatter:{title:"CORS Requests",sidebar_label:"CORS"},sidebar:"someSidebar",previous:{title:"CSRF",permalink:"/docs/3.x/security/csrf-protection"},next:{title:"Rate Limiting",permalink:"/docs/3.x/security/rate-limiting"}},l={},a=[{value:"Enable Cross-Origin Resource Sharing (CORS)",id:"enable-cross-origin-resource-sharing-cors",level:2},{value:"CORS Requests and <code>Authorization</code> header",id:"cors-requests-and-authorization-header",level:2},{value:"CORS Requests and Cookies",id:"cors-requests-and-cookies",level:2}];function d(e){const s={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"Building a public API requires to allow Cross-Origin Request Sharing."}),"\n",(0,r.jsx)(s.h2,{id:"enable-cross-origin-resource-sharing-cors",children:"Enable Cross-Origin Resource Sharing (CORS)"}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["If you are building a web application, ",(0,r.jsx)(s.strong,{children:"you may not need to enable CORS for your API"}),". See ",(0,r.jsx)(s.a,{href:"/docs/3.x/frontend/angular-react-vue",children:"here"})," the section ",(0,r.jsx)(s.em,{children:"Origins that Do not Match"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["If you want different origins to make requests to your API from a browser, you need to enable ",(0,r.jsx)(s.a,{href:"https://www.html5rocks.com/en/tutorials/cors/",children:"Cross-Origin Resource Sharing"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["You can do that by adding a route handler and a special hook to your API root controller (",(0,r.jsx)(s.code,{children:"APIController"})," in this example)."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"import { Context, Hook, HttpResponseNoContent, Options } from '@foal/core';\n\n@Hook(() => response => {\n  // Every response of this controller and its sub-controllers will be added this header.\n  response.setHeader('Access-Control-Allow-Origin', '*');\n})\nexport class ApiController {\n\n  subControllers = [\n    // your sub-controllers\n  ];\n\n  @Options('*')\n  options(ctx: Context) {\n    const response = new HttpResponseNoContent();\n    response.setHeader('Access-Control-Allow-Methods', 'HEAD, GET, POST, PUT, PATCH, DELETE');\n    // You may need to allow other headers depending on what you need.\n    response.setHeader('Access-Control-Allow-Headers', 'Content-Type');\n    return response;\n  }\n\n  // Some other routes (ex: @Get('/users'), etc)\n\n}\n"})}),"\n",(0,r.jsxs)(s.h2,{id:"cors-requests-and-authorization-header",children:["CORS Requests and ",(0,r.jsx)(s.code,{children:"Authorization"})," header"]}),"\n",(0,r.jsxs)(s.p,{children:["If your API requires a token to be sent in the ",(0,r.jsx)(s.code,{children:"Authorization"})," header, then the name of this header should be specified in the ",(0,r.jsx)(s.code,{children:"options"})," handler."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"  @Options('*')\n  options(ctx: Context) {\n    const response = new HttpResponseNoContent();\n    response.setHeader('Access-Control-Allow-Methods', 'HEAD, GET, POST, PUT, PATCH, DELETE');\n    response.setHeader('Access-Control-Allow-Headers', 'Content-Type,Authorization');\n    return response;\n  }\n"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["The same goes with other headers: ",(0,r.jsx)(s.code,{children:"X-Requested-With"}),", etc."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"cors-requests-and-cookies",children:"CORS Requests and Cookies"}),"\n",(0,r.jsxs)(s.p,{children:["If your API uses cookies (for authentication for example), then you should specify it in the hook with the ",(0,r.jsx)(s.code,{children:"Access-Control-Allow-Credentials"})," header."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"@Hook(ctx => response => {\n  response.setHeader('Access-Control-Allow-Origin', ctx.request.get('Origin') || '*');\n  response.setHeader('Access-Control-Allow-Credentials', 'true');\n})\n"})}),"\n",(0,r.jsxs)(s.p,{children:["In the browser, your HTTP client must also have its ",(0,r.jsx)(s.code,{children:"withCredentials"})," option set to ",(0,r.jsx)(s.code,{children:"true"}),"."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Examples"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:(0,r.jsx)(s.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest",children:"XMLHttpRequest"})})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"const xhr = new XMLHttpRequest();\nxhr.open('GET', 'http://example.com/', true); \nxhr.withCredentials = true; \nxhr.send(null);\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:(0,r.jsx)(s.a,{href:"https://github.com/axios/axios",children:"Axios"})})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"axios.get('http://example.com/', { withCredentials: true });\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:(0,r.jsx)(s.a,{href:"https://angular.io/guide/http",children:"Angular HttpClient"})})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"this.http.get('http://example.com/', { withCredentials: true });\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:(0,r.jsx)(s.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API",children:"fetch"})})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-javascript",children:"fetch('http://example.com/', { credentials: 'include' });\n"})})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>c});var r=n(96540);const t={},o=r.createContext(t);function i(e){const s=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(o.Provider,{value:s},e.children)}}}]);