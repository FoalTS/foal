"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9132],{47116:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>c,metadata:()=>o,toc:()=>l});var t=n(74848),i=n(28453);const c={title:"Shell Scripts"},r=void 0,o={id:"cli/shell-scripts",title:"Shell Scripts",description:"Sometimes we have to execute some tasks from the command line. These tasks can serve different purposes such as populating a database (user creation, etc) for instance. They often need to access some of the app classes and functions. This is when shell scripts come into play.",source:"@site/versioned_docs/version-3.x/cli/shell-scripts.md",sourceDirName:"cli",slug:"/cli/shell-scripts",permalink:"/docs/3.x/cli/shell-scripts",draft:!1,unlisted:!1,editUrl:"https://github.com/FoalTS/foal/edit/master/docs/versioned_docs/version-3.x/cli/shell-scripts.md",tags:[],version:"3.x",frontMatter:{title:"Shell Scripts"},sidebar:"someSidebar",previous:{title:"Commands",permalink:"/docs/3.x/cli/commands"},next:{title:"Code Generation",permalink:"/docs/3.x/cli/code-generation"}},a={},l=[{value:"Create Scripts",id:"create-scripts",level:2},{value:"Write Scripts",id:"write-scripts",level:2},{value:"Build and Run Scripts",id:"build-and-run-scripts",level:2}];function d(e){const s={blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"Sometimes we have to execute some tasks from the command line. These tasks can serve different purposes such as populating a database (user creation, etc) for instance. They often need to access some of the app classes and functions. This is when shell scripts come into play."}),"\n",(0,t.jsx)(s.h2,{id:"create-scripts",children:"Create Scripts"}),"\n",(0,t.jsxs)(s.p,{children:["A shell script is just a TypeScript file located in the ",(0,t.jsx)(s.code,{children:"src/scripts"}),". It must export a ",(0,t.jsx)(s.code,{children:"main"})," function that is then called when running the script."]}),"\n",(0,t.jsxs)(s.p,{children:["Let's create a new one with the command line: ",(0,t.jsx)(s.code,{children:"foal g script display-users"}),". A new file with a default template should appear in you ",(0,t.jsx)(s.code,{children:"src/scripts"})," directory."]}),"\n",(0,t.jsx)(s.h2,{id:"write-scripts",children:"Write Scripts"}),"\n",(0,t.jsxs)(s.p,{children:["Remove the content of ",(0,t.jsx)(s.code,{children:"src/scripts/display-users.ts"})," and replace it with the code below."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-typescript",children:"// 3p\nimport { createService } from '@foal/core';\n\n// App\nimport { dataSource } from '../db';\nimport { User } from '../app/entities';\nimport { Logger } from '../app/services';\n\nexport async function main() {\n  await dataSource.initialize();\n\n  try {\n    const users = await User.find();\n    const logger = createService(Logger);\n    logger.log(users);\n  } finally {\n    dataSource.destroy();\n  }\n}\n\n"})}),"\n",(0,t.jsxs)(s.p,{children:["As you can see, we can easily establish a connection to the database in the script as well as import some of the app components (the ",(0,t.jsx)(s.code,{children:"User"})," in this case)."]}),"\n",(0,t.jsxs)(s.p,{children:["Encapsulating your code in a ",(0,t.jsx)(s.code,{children:"main"})," function without calling it directly in the file has several benefits:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["You can import and test your ",(0,t.jsx)(s.code,{children:"main"})," function in a separate file."]}),"\n",(0,t.jsx)(s.li,{children:"Using a function lets you easily use async/await keywords when dealing with asynchronous code."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"build-and-run-scripts",children:"Build and Run Scripts"}),"\n",(0,t.jsx)(s.p,{children:"To run a script you first need to build it."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"npm run build\n"})}),"\n",(0,t.jsx)(s.p,{children:"Then you can execute it with this command:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"foal run my-script # or foal run-script my-script\n"})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["You can also provide additionnal arguments to your script (for example: ",(0,t.jsx)(s.code,{children:"foal run my-script foo=1 bar='[ 3, 4 ]'"}),"). The default template in the generated scripts shows you how to handle such behavior."]}),"\n"]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["If you want your script to recompile each time you save the file, you can run ",(0,t.jsx)(s.code,{children:"npm run dev"})," in a separate terminal."]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>o});var t=n(96540);const i={},c=t.createContext(i);function r(e){const s=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(c.Provider,{value:s},e.children)}}}]);