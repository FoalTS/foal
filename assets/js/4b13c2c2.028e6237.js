"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[48537],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var o=s(96540);const c={},r=o.createContext(c);function t(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),o.createElement(r.Provider,{value:n},e.children)}},78620:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>a,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"cookbook/scheduling-jobs","title":"Scheduling Jobs","description":"You can schedule jobs using shell scripts and the node-schedule library.","source":"@site/versioned_docs/version-2.x/cookbook/scheduling-jobs.md","sourceDirName":"cookbook","slug":"/cookbook/scheduling-jobs","permalink":"/docs/2.x/cookbook/scheduling-jobs","draft":false,"unlisted":false,"editUrl":"https://github.com/FoalTS/foal/edit/master/docs/versioned_docs/version-2.x/cookbook/scheduling-jobs.md","tags":[],"version":"2.x","frontMatter":{"title":"Scheduling Jobs"},"sidebar":"someSidebar","previous":{"title":"XSS Protection","permalink":"/docs/2.x/security/xss-protection"},"next":{"title":"404 Page","permalink":"/docs/2.x/cookbook/not-found-page"}}');var c=s(74848),r=s(28453);const t={title:"Scheduling Jobs"},l=void 0,i={},d=[{value:"Example",id:"example",level:2},{value:"Background Jobs with pm2",id:"background-jobs-with-pm2",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.p,{children:["You can schedule jobs using ",(0,c.jsx)(n.a,{href:"/docs/2.x/development-environment/create-and-run-scripts",children:"shell scripts"})," and the ",(0,c.jsx)(n.a,{href:"https://www.npmjs.com/package/node-schedule",children:"node-schedule"})," library."]}),"\n",(0,c.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.em,{children:"scripts/fetch-metrics.ts"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"export function main(args: any) {\n  // Do some stuff\n}\n\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.em,{children:"scripts/schedule-jobs.ts"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"// 3p\nimport { scheduleJob } from 'node-schedule';\nimport { main as fetchMetrics } from './fetch-metrics';\n\nexport async function main(args: any) {\n  console.log('Scheduling the job...');\n\n  // Run the fetch-metrics script every day at 10:00 AM.\n  scheduleJob(\n    { hour: 10, minute: 0 },\n    () => fetchMetrics(args)\n  );\n\n  console.log('Job scheduled!');\n}\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Schedule the job(s):"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"npm run build\nfoal run schedule-jobs arg1=value1\n"})}),"\n",(0,c.jsx)(n.h2,{id:"background-jobs-with-pm2",children:"Background Jobs with pm2"}),"\n",(0,c.jsxs)(n.p,{children:["While the above command works, it does not run the scheduler and the jobs in the background. To do this, you can use ",(0,c.jsx)(n.a,{href:"http://pm2.keymetrics.io/",children:"pm2"}),", a popular process manager for Node.js."]}),"\n",(0,c.jsxs)(n.p,{children:["First you need to install ",(0,c.jsx)(n.em,{children:"locally"})," the Foal CLI:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install @foal/cli\n"})}),"\n",(0,c.jsx)(n.p,{children:"Then you can run the scheduler like this:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"pm2 start ./node_modules/.bin/foal --name scheduler -- run schedule-jobs arg1=value1\n"})}),"\n",(0,c.jsx)(n.p,{children:"If everything works fine, you should see your scheduler running with this command:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"pm2 ls\n"})}),"\n",(0,c.jsx)(n.p,{children:"To display the logs of the scheduler and the jobs, use this one:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"pm2 logs scheduler\n"})}),"\n",(0,c.jsx)(n.p,{children:"Eventually, to stop the scheduler and the jobs, you can use this command:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"pm2 delete scheduler\n"})})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(h,{...e})}):h(e)}}}]);