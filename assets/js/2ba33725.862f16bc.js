"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6250],{89965:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var o=s(74848),t=s(28453);const r={title:"Public API & CORS Requests"},i=void 0,c={id:"api-section/public-api-and-cors-requests",title:"Public API & CORS Requests",description:"Building an Open API requires to allow Cross-Origin Request Sharing.",source:"@site/versioned_docs/version-2.x/api-section/public-api-and-cors-requests.md",sourceDirName:"api-section",slug:"/api-section/public-api-and-cors-requests",permalink:"/docs/2.x/api-section/public-api-and-cors-requests",draft:!1,unlisted:!1,editUrl:"https://github.com/FoalTS/foal/edit/master/docs/versioned_docs/version-2.x/api-section/public-api-and-cors-requests.md",tags:[],version:"2.x",frontMatter:{title:"Public API & CORS Requests"},sidebar:"someSidebar",previous:{title:"OpenAPI & Swagger UI",permalink:"/docs/2.x/api-section/openapi-and-swagger-ui"},next:{title:"GraphQL",permalink:"/docs/2.x/api-section/graphql"}},a={},l=[{value:"Enable Cross-Origin Resource Sharing (CORS)",id:"enable-cross-origin-resource-sharing-cors",level:2},{value:"CORS Requests and <code>Authorization</code> header",id:"cors-requests-and-authorization-header",level:2},{value:"CORS Requests and Cookies",id:"cors-requests-and-cookies",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Building an Open API requires to allow Cross-Origin Request Sharing."}),"\n",(0,o.jsx)(n.h2,{id:"enable-cross-origin-resource-sharing-cors",children:"Enable Cross-Origin Resource Sharing (CORS)"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["If you are building a web application, ",(0,o.jsx)(n.strong,{children:"you may not need to enable CORS for your API"}),". See ",(0,o.jsx)(n.a,{href:"/docs/2.x/frontend-integration/angular-react-vue",children:"here"})," the section ",(0,o.jsx)(n.em,{children:"Origins that Do not Match"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["If you want different origins to make requests to your API from a browser, you need to enable ",(0,o.jsx)(n.a,{href:"https://www.html5rocks.com/en/tutorials/cors/",children:"Cross-Origin Resource Sharing"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["You can do that by adding a route handler and a special hook to your API root controller (",(0,o.jsx)(n.code,{children:"APIController"})," in this example)."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { Context, Hook, HttpResponseNoContent, Options } from '@foal/core';\n\n@Hook(() => response => {\n  // Every response of this controller and its sub-controllers will be added this header.\n  response.setHeader('Access-Control-Allow-Origin', '*');\n})\nexport class ApiController {\n\n  subControllers = [\n    // your sub-controllers\n  ];\n\n  @Options('*')\n  options(ctx: Context) {\n    const response = new HttpResponseNoContent();\n    response.setHeader('Access-Control-Allow-Methods', 'HEAD, GET, POST, PUT, PATCH, DELETE');\n    // You may need to allow other headers depending on what you need.\n    response.setHeader('Access-Control-Allow-Headers', 'Content-Type');\n    return response;\n  }\n\n  // Some other routes (ex: @Get('/users'), etc)\n\n}\n"})}),"\n",(0,o.jsxs)(n.h2,{id:"cors-requests-and-authorization-header",children:["CORS Requests and ",(0,o.jsx)(n.code,{children:"Authorization"})," header"]}),"\n",(0,o.jsxs)(n.p,{children:["If your API requires a token to be sent in the ",(0,o.jsx)(n.code,{children:"Authorization"})," header, then the name of this header should be specified in the ",(0,o.jsx)(n.code,{children:"options"})," handler."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"  @Options('*')\n  options(ctx: Context) {\n    const response = new HttpResponseNoContent();\n    response.setHeader('Access-Control-Allow-Methods', 'HEAD, GET, POST, PUT, PATCH, DELETE');\n    response.setHeader('Access-Control-Allow-Headers', 'Content-Type,Authorization');\n    return response;\n  }\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["The same goes with other headers: ",(0,o.jsx)(n.code,{children:"X-Requested-With"}),", etc."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"cors-requests-and-cookies",children:"CORS Requests and Cookies"}),"\n",(0,o.jsxs)(n.p,{children:["If your API uses cookies (for authentication for example), then you should specify it in the hook with the ",(0,o.jsx)(n.code,{children:"Access-Control-Allow-Credentials"})," header."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"@Hook(ctx => response => {\n  response.setHeader('Access-Control-Allow-Origin', ctx.request.get('Origin') || '*');\n  response.setHeader('Access-Control-Allow-Credentials', 'true');\n})\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In the browser, your HTTP client must also have its ",(0,o.jsx)(n.code,{children:"withCredentials"})," option set to ",(0,o.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Examples"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest",children:"XMLHttpRequest"})})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const xhr = new XMLHttpRequest();\nxhr.open('GET', 'http://example.com/', true); \nxhr.withCredentials = true; \nxhr.send(null);\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.a,{href:"https://github.com/axios/axios",children:"Axios"})})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"axios.get('http://example.com/', { withCredentials: true });\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.a,{href:"https://angular.io/guide/http",children:"Angular HttpClient"})})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"this.http.get('http://example.com/', { withCredentials: true });\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:(0,o.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API",children:"fetch"})})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"fetch('http://example.com/', { credentials: 'include' });\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var o=s(96540);const t={},r=o.createContext(t);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);