"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1864],{28188:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"tutorials/real-world-example-with-react/tuto-10-auth-with-react","title":"Autenticaci\xf3n en React","description":"La API del backend est\xe1 lista para ser utilizada. Ahora vamos a a\xf1adir la autenticaci\xf3n en el lado del frontend.","source":"@site/i18n/es/docusaurus-plugin-content-docs/version-2.x/tutorials/real-world-example-with-react/10-auth-with-react.md","sourceDirName":"tutorials/real-world-example-with-react","slug":"/tutorials/real-world-example-with-react/10-auth-with-react","permalink":"/es/docs/2.x/tutorials/real-world-example-with-react/10-auth-with-react","draft":false,"unlisted":false,"editUrl":"https://github.com/FoalTS/foal/edit/master/docs/versioned_docs/version-2.x/tutorials/real-world-example-with-react/10-auth-with-react.md","tags":[],"version":"2.x","sidebarPosition":10,"frontMatter":{"title":"Autenticaci\xf3n en React","id":"tuto-10-auth-with-react","slug":"10-auth-with-react"},"sidebar":"someSidebar","previous":{"title":"Autenticaci\xf3n en la API","permalink":"/es/docs/2.x/tutorials/real-world-example-with-react/9-authenticated-api"},"next":{"title":"A\xf1adida de la p\xe1gina de inscripci\xf3n","permalink":"/es/docs/2.x/tutorials/real-world-example-with-react/11-sign-up"}}');var r=a(74848),s=a(28453);const o={title:"Autenticaci\xf3n en React",id:"tuto-10-auth-with-react",slug:"10-auth-with-react"},t=void 0,c={},l=[];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"La API del backend est\xe1 lista para ser utilizada. Ahora vamos a a\xf1adir la autenticaci\xf3n en el lado del frontend."}),"\n",(0,r.jsx)(n.p,{children:"As\xed es como se organiza la aplicaci\xf3n React:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Al hacer clic en el bot\xf3n ",(0,r.jsx)(n.em,{children:"Log in"})," o ",(0,r.jsx)(n.em,{children:"Log out"}),", la aplicaci\xf3n llama a las funciones definidas en ",(0,r.jsx)(n.code,{children:"requests/auth.ts"})," para realizar consultas al servidor."]}),"\n",(0,r.jsxs)(n.li,{children:["La informaci\xf3n sobre el usuario actual se almacena en el componente ra\xedz ",(0,r.jsx)(n.code,{children:"App.tsx"})," bajo el nombre ",(0,r.jsx)(n.code,{children:"currentUser"}),". Si el usuario se ha conectado, este estado es de tipo ",(0,r.jsx)(n.code,{children:"{ id: number, name: string }"}),". En caso contrario, su valor es ",(0,r.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Al iniciar la sesi\xf3n, el servidor devuelve informaci\xf3n sobre el usuario que se utiliza para establecer el estado ",(0,r.jsx)(n.code,{children:"currentUser"}),". Al cerrar la sesi\xf3n, la aplicaci\xf3n establece este estado como ",(0,r.jsx)(n.code,{children:"null"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Saber, en el lado del cliente, si un usuario est\xe1 conectado y qui\xe9n es, es \xfatil para gestionar la visualizaci\xf3n de los elementos de la interfaz de usuario. Esto nos permite, por ejemplo, saber qu\xe9 botones de navegaci\xf3n deben ser visibles."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Abra el archivo ",(0,r.jsx)(n.code,{children:"requests/auth.ts"})," e implemente las funciones vac\xedas."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import axios from 'axios';\nimport { ICredentials, IUser } from '../interfaces';\n\nexport async function logIn(credentials: ICredentials): Promise<IUser> {\n  const response = await axios.post<IUser>('/api/auth/login', credentials);\n  return response.data;\n}\n\nexport async function logOut(): Promise<void> {\n  await axios.post('/api/auth/logout');\n}\n\nexport async function signUp(credentials: ICredentials): Promise<IUser> {\n  const response = await axios.post<IUser>('/api/auth/signup', credentials);\n  return response.data;\n}\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Vaya a ",(0,r.jsx)(n.a,{href:"http://localhost:3000/login",children:"http://localhost:3000/login"})," y con\xe9ctese. Deber\xeda ser redirigido a la p\xe1gina de inicio. Si hace clic en el bot\xf3n ",(0,r.jsx)(n.em,{children:"Profile"})," de la barra de navegaci\xf3n, deber\xeda ser llevado a su p\xe1gina personal. Puede a\xf1adir o eliminar publicaciones si lo desea."]}),"\n",(0,r.jsx)(n.p,{children:"Ahora vamos a actualizar la p\xe1gina. Se le redirige a la p\xe1gina de inicio de sesi\xf3n como si hubiera cerrado la sesi\xf3n. \xa1Ay!"}),"\n",(0,r.jsxs)(n.p,{children:["La raz\xf3n de esto es que la aplicaci\xf3n del front-end ya no sabe que usted est\xe1 conectado. Si mira el componente ",(0,r.jsx)(n.code,{children:"App"}),", ver\xe1 que el estado ",(0,r.jsx)(n.code,{children:"currentUser"})," se inicializa a ",(0,r.jsx)(n.code,{children:"null"})," cuando se carga la aplicaci\xf3n. As\xed que tenemos que encontrar una manera de mantener el estado de inicio de sesi\xf3n del usuario incluso si la p\xe1gina se actualiza."]}),"\n",(0,r.jsx)(n.p,{children:"Para ello, utilizaremos una cookie adicional para almacenar esta informaci\xf3n que ser\xe1 legible por la aplicaci\xf3n front-end."}),"\n",(0,r.jsxs)(n.p,{children:["Abra el archivo ",(0,r.jsx)(n.code,{children:"api.controller.ts"})," y a\xf1ada la opci\xf3n ",(0,r.jsx)(n.code,{children:"userCookie"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Context } from '@foal/core';\n\n// ...\n\n@UseSessions({\n  cookie: true,\n  user: fetchUser(User),\n  userCookie: (ctx: Context<User|undefined>) => ctx.user ? JSON.stringify({ id: ctx.user.id, name: ctx.user.name }) : '',\n})\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Esta opci\xf3n establece una cookie adicional ",(0,r.jsx)(n.code,{children:"user"})," en el host del cliente con informaci\xf3n sobre el usuario actual."]}),"\n",(0,r.jsxs)(n.p,{children:["Ahora vuelva al archivo ",(0,r.jsx)(n.code,{children:"App.tsx"})," y a\xf1ada la funci\xf3n ",(0,r.jsx)(n.code,{children:"getCurrentUserFromCookie"})," que aparece a continuaci\xf3n."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import * as cookie from 'cookie';\n\nfunction getCurrentUserFromCookie(): IUser | null {\n  const userCookie = cookie.parse(document.cookie).user as string|undefined;\n  if (!userCookie) {\n    return null;\n  }\n  try {\n    return JSON.parse(userCookie);\n  } catch (error) {\n    return null;\n  }\n}\n\nexport default function App() {\n  const [currentUser, setCurrentUser] = useState(getCurrentUserFromCookie());\n\n  // ...\n\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Cuando la aplicaci\xf3n se carga, esta funci\xf3n comprobar\xe1 si existe una cookie ",(0,r.jsx)(n.code,{children:"user"})," con informaci\xf3n sobre el usuario actual. Si es as\xed, su contenido se utilizar\xe1 para establecer el valor de ",(0,r.jsx)(n.code,{children:"currentUser"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Actualice la p\xe1gina. La aplicaci\xf3n ahora funciona como se esperaba."}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Tambi\xe9n podr\xeda haber establecido una cookie del lado del cliente en la funci\xf3n ",(0,r.jsx)(n.code,{children:"logIn"})," y eliminarla en la funci\xf3n ",(0,r.jsx)(n.code,{children:"logOut"}),". Pero esta soluci\xf3n no funciona bien cuando el usuario se desconecta autom\xe1ticamente despu\xe9s de un per\xedodo de inactividad (expiraci\xf3n de la sesi\xf3n)."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>t});var i=a(96540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);